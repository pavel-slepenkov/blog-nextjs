<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><link href="https://unpkg.com/prismjs@1.23.0/themes/prism-okaidia.css" rel="stylesheet"/><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="description" content="Pavel Slepenkov&#x27;s personal blog: stories about BI, python, salesforce and data analysis"/><meta http-equiv="cache-control" content="Private"/><meta http-equiv="Expires" content="366000"/><meta property="og:locale" content="en_US"/><meta name="og:title" content="Pavel Slepenkov&#x27;s personal blog"/><meta property="og:description" content="stories about BI, python, salesforce and data analysis"/><meta property="og:type" content="article"/><meta property="og:site_name" content="pavelslepenkov.info"/><meta property="og:image" content="/og.png"/><meta name="twitter:title" content="Pavel Slepenkov&#x27;s personal blog"/><meta name="twitter:description" content="stories about BI, python, salesforce and data analysis"/><meta name="twitter:card" content="summary_large_image"/><meta property="twitter:image" content="/og.png"/><meta name="keywords" content="python, BI, sql, salesforce, data engineering, apex, soql, data analisys"/><meta name="yandex-verification" content="35a3887ea995a4c4"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-63037633-1"></script><script>
                            window.dataLayer = window.dataLayer || [];
                            function gtag(){dataLayer.push(arguments);}
                            gtag('js', new Date());
                            gtag('config', 'UA-63037633-1');
                    </script><style>@import url(&#x27;https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300&amp;family=Spectral:wght@300;600&amp;display=swap&#x27;);</style><title>Extract numbers from string in python with real life example</title><meta name="next-head-count" content="24"/><link rel="preload" href="/_next/static/css/e1ade21c945e1e76c25a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e1ade21c945e1e76c25a.css" data-n-g=""/><link rel="preload" href="/_next/static/css/6dce80f39b6e217927f5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6dce80f39b6e217927f5.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-d99e70035f31fbf26280.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.ef157c678a62cfb2c073.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.0cd3f0b406132b99fef1.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-f576db2e6f64d3b421e3.js" as="script"/><link rel="preload" href="/_next/static/chunks/b435696c38dfa3a566dd7089f731d08d7e0bf097.f940d483b5a1fae10b21.js" as="script"/><link rel="preload" href="/_next/static/chunks/1d62a1056678c2f23610de94ff6f49e06a569636.b588272bed0c9114d503.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bid%5D-dd3e2b826f95ad4c71da.js" as="script"/></head><body><script src="noflash.js"></script><script src="PathSolver.js"></script><div id="__next"><div class="layout_container__2t4v2"><div class="no-print"><header class="layout_header__2rhWq"><div class="navbar-link"><a class="layout_devNull__6Fs9d" href="/">$ /dev/null</a>—————<a class="layout_devNull__6Fs9d" href="/cv">CV</a></div><div class="DarkModeToggle_darkModeToggle__2u4u3"><button type="button">☀</button><toggle></toggle><button type="button">☾</button></div></header></div><main><article><h1 class="utils_headingXl__1XecN">Extract numbers from string in python with real life example</h1><div class="utils_lightText__12Ckm"><time dateTime="2021-01-05T10:30:35+00:00">January 5, 2021</time></div><div><p>Extract numbers from string - <ps2>Realy?!!? What a topic for a blog post?!?</ps2> - you'd say when see that. But wait a minute I'll try to make it a bit interesting.</p>
<blockquote>
<p><strong>Disclimer:</strong> This post shows some reflection on a way how to solve software problems as well as practical solution of named problem. There's nothing interesting for seasoned software engineers but less experienced devs can find something useful here</p>
</blockquote>
<p>In this post:</p>
<ul>
<li>Real life problem</li>
<li>5 basic solutions</li>
<li>2 real life solutions</li>
<li>Benchmark</li>
</ul>
<p>Recently one of our ETL pipeline was broken by unexpected input which came from pentesters. They tried to investigate some logging endpoints of the main app and posted JSONs with garbage. Later this JSONs came to etl and destroyed it in part of several workers. These workers grab JSON, parse it, make some additional processing and finally save to database. The part with saving to DB was broken because of type inconsistency.</p>
<p>Input for a functions which must be a numeric eventually started looking like that</p>
<div class="remark-highlight"><pre class="language-md"><code class="language-md">{$ 90011000001
&#x3C;# 172.9000900111
{% 1792.2542200656937
&#x3C;#if0
&#x3C;#if100.023
</code></pre></div>
<p>Our ETL processing is running by a bunch of tiny python functions glued by some functional magic. Parsing numbers from string is not a task which you normally need to solve because of API agrements. Thus we have nothing in our utilities. Actually, parsing numbers from string looks awkward from technical perspective if you do not scrape something on web or from files. But the reality is that this is the most correct way to solve the problem.</p>
<p>Other oprtions to consider:</p>
<ul>
<li>filter / ignore all such input because it's only ~0.02% of all</li>
<li>replace all bad input with None</li>
<li>catch exception and ignore</li>
</ul>
<p>But all these solutions mean to lose some data.</p>
<p>As our workers process a large amout of data and utilize pretty much resources I preffer not to introduce any new imports for this processor or at least use only standard lib when possible. Also by this reason we need to evaluate performace and choose faster one.</p>
<p>The first thing I preffer to do when I need to write any new piece of code which I didn't code in the last 6-8 months is to google for the solution. It allows to check if something new came to the scene and update knowledges. I checked a few article and docs, including <a href="https://stackoverflow.com/questions/4289331/how-to-extract-numbers-from-a-string-in-python">stackoverflow</a>.</p>
<p>Most of the examples are very basic, some limited only to positive integers (<em>This is one of the reasons why I ever started writing this article</em>)</p>
<p>Lets check these solutions with <code>sentence = 'String with 42, 3.1415 and 1000'</code></p>
<ol>
<li>Using Regex Module</li>
</ol>
<div class="remark-highlight"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> re
s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">for</span> s <span class="token keyword">in</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'-?\d+\.?\d*'</span><span class="token punctuation">,</span> sentence<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token operator">>></span> <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">3.1415</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">]</span>
</code></pre></div>
<ol start="2">
<li>Split and Append The Numbers To A List using <code>split()</code> and <code>append()</code> Functions</li>
</ol>
<div class="remark-highlight"><pre class="language-python"><code class="language-python">s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> t <span class="token keyword">in</span> sentence<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        s<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
<span class="token operator">>></span> <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">3.1415</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">]</span>
</code></pre></div>
<ol start="3">
<li>Using <code>nums_from_string</code> library. <code>pip install nums_from_string</code> then</li>
</ol>
<div class="remark-highlight"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> nums_from_string
sentence <span class="token operator">=</span> <span class="token string">'Extract 100 , 100.45 and 10000 from this string'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>nums_from_string<span class="token punctuation">.</span>get_nums<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span> <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">3.1415</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">]</span>
</code></pre></div>
<p><strong>Solutions limited to only positive integers</strong></p>
<ol start="4">
<li>Using isdigit() function in a list comprehension</li>
</ol>
<div class="remark-highlight"><pre class="language-python"><code class="language-python">s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">for</span> s <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span> <span class="token keyword">if</span> s<span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token operator">>></span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">]</span>
</code></pre></div>
<p>and varaiation of the above solution
5. <code>filter</code> + <code>str.isdigit</code> (You can create more complex filter function)</p>
<div class="remark-highlight"><pre class="language-python"><code class="language-python"><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">.</span>isdigit<span class="token punctuation">,</span> sentence<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">]</span>
</code></pre></div>
<p><em>Actually here're many variation of these basis solutions with some changes.</em></p>
<p>Finally here're 2 possible solutions which fit for my case and requirements:</p>
<ul>
<li>replace <em>bad</em> chars, split string and check every part for numbers</li>
<li>use regex</li>
</ul>
<p>Notes:</p>
<ul>
<li>for my case I need to extract only first found number</li>
<li>I consider 3.14 == 3,14 in string and converts it to a number. That's not a standard approach.</li>
</ul>
<p>With StackOverflow in hands most of us start coding just in time when possible solution is found. I try to create tests first.
So, lets create a test which allows us to evaluate solutions.</p>
<div class="remark-highlight"><pre class="language-python"><code class="language-python">test_set <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">"{% 152.2795837829749"</span><span class="token punctuation">,</span>
    <span class="token string">"{% 1608577297370"</span><span class="token punctuation">,</span>
    <span class="token string">"&#x3C;#if 1608577297618 %%}"</span><span class="token punctuation">,</span>
    <span class="token string">"1608577297618 %%} 88912"</span><span class="token punctuation">,</span>
    <span class="token string">"788"</span><span class="token punctuation">,</span>
    <span class="token string">"89.981"</span><span class="token punctuation">,</span>
    <span class="token string">"n55b30"</span><span class="token punctuation">,</span>
    <span class="token string">">=123233333332324323"</span><span class="token punctuation">,</span>
    <span class="token string">"&#x26;>>> 1231"</span><span class="token punctuation">,</span>
    <span class="token string">"9000001"</span><span class="token punctuation">,</span>
    <span class="token string">"42"</span><span class="token punctuation">,</span>
    <span class="token string">"bba"</span><span class="token punctuation">,</span>
    <span class="token string">"!@#$%^&#x26;*()231122223"</span><span class="token punctuation">,</span>
    <span class="token string">"-99,01"</span><span class="token punctuation">,</span>
    <span class="token string">"100,001.2000"</span><span class="token punctuation">,</span>
    <span class="token string">"what about very long string ? with a number - 2000.002??? "</span><span class="token punctuation">,</span>
    <span class="token string">"and ever much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much longer string 10990.2"</span><span class="token punctuation">,</span>
    <span class="token string">""</span><span class="token punctuation">,</span>
    <span class="token string">"!@#$%^&#x26;*()_+"</span><span class="token punctuation">,</span>
    <span class="token string">"!@#$%^&#x26;*()_+900.42!@#$%^&#x26;*()_+!@#$%^&#x26;*()_+!@#$%^&#x26;*()_+iiiiiiEEEEE^^^^^"</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

expected_result <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">152.2795837829749</span><span class="token punctuation">,</span> <span class="token number">1608577297370</span><span class="token punctuation">,</span> <span class="token number">1608577297618</span><span class="token punctuation">,</span> <span class="token number">1608577297618</span><span class="token punctuation">,</span>
    <span class="token number">788</span><span class="token punctuation">,</span> <span class="token number">89.981</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">123233333332324323</span><span class="token punctuation">,</span> <span class="token number">1231</span><span class="token punctuation">,</span> <span class="token number">9000001</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span>
    <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">231122223</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">99.01</span><span class="token punctuation">,</span> <span class="token number">100.001</span><span class="token punctuation">,</span> <span class="token number">2000.002</span><span class="token punctuation">,</span> <span class="token number">10990.2</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">900.42</span>
<span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">run_test</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">:</span>
    l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> s <span class="token keyword">in</span> test_set<span class="token punctuation">:</span>
        l<span class="token punctuation">.</span>append<span class="token punctuation">(</span>fn<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> l <span class="token operator">==</span> expected_result
</code></pre></div>
<p>I finished with 2 approaches</p>
<p><ps1>Solution 1</ps1> - replace, split and append</p>
<p><em>Start with replacing chars which can be clumped with our number, then split string to list, go through each element of the list and try to convert these parts to a numbers - int or float.</em></p>
<div class="remark-highlight"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">sanitize_1</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> t <span class="token keyword">in</span> s<span class="token punctuation">.</span>translate<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token string">" "</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&#x26;*()[]{};:/&#x3C;>?\|`~=_+"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            t <span class="token operator">=</span> t<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token string">'.'</span> <span class="token keyword">in</span> t<span class="token punctuation">:</span>
                a1 <span class="token operator">=</span> t<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
                l<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>a1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                l<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>
            <span class="token keyword">pass</span>
    <span class="token keyword">return</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">if</span> l <span class="token keyword">else</span> <span class="token boolean">None</span>
</code></pre></div>
<p><em>There's potential problem with this code - <code>split()</code> might create huge list on complex strings and thus increases number of loops with all the stuff inside.</em></p>
<p><ps1>Solution 2</ps1> use <strong>RegEx</strong>
Using of regex is considered to be a slightly bad practice.</p>
<div class="remark-highlight"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">sanitize_2</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    l<span class="token punctuation">.</span>extend<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token string">'.'</span> <span class="token keyword">in</span> t <span class="token keyword">else</span> <span class="token builtin">int</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">for</span> t <span class="token keyword">in</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'[-]?\d+(?:\.\d+)?'</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">if</span> l <span class="token keyword">else</span> <span class="token boolean">None</span>
</code></pre></div>
<p>Okay, lets test them on performance. I'm using ipython cell magic <code>%timeit</code> as most simple way to evaluate performance</p>
<div class="remark-highlight"><pre class="language-python"><code class="language-python"><span class="token operator">%</span>timeit run_test<span class="token punctuation">(</span>sanitize_1<span class="token punctuation">)</span>
<span class="token operator">%</span>timeit run_test<span class="token punctuation">(</span>sanitize_2<span class="token punctuation">)</span>

<span class="token number">236</span> µs ± <span class="token number">11.7</span> µs per loop <span class="token punctuation">(</span>mean ± std<span class="token punctuation">.</span> dev<span class="token punctuation">.</span> of <span class="token number">7</span> runs<span class="token punctuation">,</span> <span class="token number">10000</span> loops each<span class="token punctuation">)</span>
<span class="token number">72.2</span> µs ± <span class="token number">1.12</span> µs per loop <span class="token punctuation">(</span>mean ± std<span class="token punctuation">.</span> dev<span class="token punctuation">.</span> of <span class="token number">7</span> runs<span class="token punctuation">,</span> <span class="token number">10000</span> loops each<span class="token punctuation">)</span>
</code></pre></div>
<p>Regex approach is much faster, moover it's much shorter and simplier (sure if you know regex)</p>
<p><img src="/images/p1067/perl_problems_2x.png" alt=""></p>
<p>That's all, solution #2 won and was deployed</p>
</div></article><div><span class="utils_tag__38-Vr"><a href="/tag/python">[<!-- -->python<!-- -->]</a></span><span class="utils_tag__38-Vr"><a href="/tag/python3">[<!-- -->python3<!-- -->]</a></span><span class="utils_tag__38-Vr"><a href="/tag/benchmark">[<!-- -->benchmark<!-- -->]</a></span></div></main><div class="layout_backToHome__1vZsp"><a href="/">⇐ back to home</a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"extract-numbers-from-string-in-python","contentHtml":"\u003cp\u003eExtract numbers from string - \u003cps2\u003eRealy?!!? What a topic for a blog post?!?\u003c/ps2\u003e - you'd say when see that. But wait a minute I'll try to make it a bit interesting.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eDisclimer:\u003c/strong\u003e This post shows some reflection on a way how to solve software problems as well as practical solution of named problem. There's nothing interesting for seasoned software engineers but less experienced devs can find something useful here\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eIn this post:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eReal life problem\u003c/li\u003e\n\u003cli\u003e5 basic solutions\u003c/li\u003e\n\u003cli\u003e2 real life solutions\u003c/li\u003e\n\u003cli\u003eBenchmark\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eRecently one of our ETL pipeline was broken by unexpected input which came from pentesters. They tried to investigate some logging endpoints of the main app and posted JSONs with garbage. Later this JSONs came to etl and destroyed it in part of several workers. These workers grab JSON, parse it, make some additional processing and finally save to database. The part with saving to DB was broken because of type inconsistency.\u003c/p\u003e\n\u003cp\u003eInput for a functions which must be a numeric eventually started looking like that\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-md\"\u003e\u003ccode class=\"language-md\"\u003e{$ 90011000001\n\u0026#x3C;# 172.9000900111\n{% 1792.2542200656937\n\u0026#x3C;#if0\n\u0026#x3C;#if100.023\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOur ETL processing is running by a bunch of tiny python functions glued by some functional magic. Parsing numbers from string is not a task which you normally need to solve because of API agrements. Thus we have nothing in our utilities. Actually, parsing numbers from string looks awkward from technical perspective if you do not scrape something on web or from files. But the reality is that this is the most correct way to solve the problem.\u003c/p\u003e\n\u003cp\u003eOther oprtions to consider:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003efilter / ignore all such input because it's only ~0.02% of all\u003c/li\u003e\n\u003cli\u003ereplace all bad input with None\u003c/li\u003e\n\u003cli\u003ecatch exception and ignore\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eBut all these solutions mean to lose some data.\u003c/p\u003e\n\u003cp\u003eAs our workers process a large amout of data and utilize pretty much resources I preffer not to introduce any new imports for this processor or at least use only standard lib when possible. Also by this reason we need to evaluate performace and choose faster one.\u003c/p\u003e\n\u003cp\u003eThe first thing I preffer to do when I need to write any new piece of code which I didn't code in the last 6-8 months is to google for the solution. It allows to check if something new came to the scene and update knowledges. I checked a few article and docs, including \u003ca href=\"https://stackoverflow.com/questions/4289331/how-to-extract-numbers-from-a-string-in-python\"\u003estackoverflow\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eMost of the examples are very basic, some limited only to positive integers (\u003cem\u003eThis is one of the reasons why I ever started writing this article\u003c/em\u003e)\u003c/p\u003e\n\u003cp\u003eLets check these solutions with \u003ccode\u003esentence = 'String with 42, 3.1415 and 1000'\u003c/code\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eUsing Regex Module\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e re\ns \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token builtin\"\u003efloat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003es\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e s \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e re\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efindall\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003er'-?\\d+\\.?\\d*'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e sentence\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e42\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e3.1415\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1000\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eSplit and Append The Numbers To A List using \u003ccode\u003esplit()\u003c/code\u003e and \u003ccode\u003eappend()\u003c/code\u003e Functions\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003es \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e t \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e sentence\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esplit\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        s\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eappend\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token builtin\"\u003efloat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003et\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eexcept\u003c/span\u003e ValueError\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003epass\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e42\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e3.1415\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1000\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003eUsing \u003ccode\u003enums_from_string\u003c/code\u003e library. \u003ccode\u003epip install nums_from_string\u003c/code\u003e then\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e nums_from_string\nsentence \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'Extract 100 , 100.45 and 10000 from this string'\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enums_from_string\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eget_nums\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esentence\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e42\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e3.1415\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1000\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cstrong\u003eSolutions limited to only positive integers\u003c/strong\u003e\u003c/p\u003e\n\u003col start=\"4\"\u003e\n\u003cli\u003eUsing isdigit() function in a list comprehension\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003es \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token builtin\"\u003eint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003es\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e s \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esplit\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esentence\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e s\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eisdigit\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e100\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e10000\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eand varaiation of the above solution\n5. \u003ccode\u003efilter\u003c/code\u003e + \u003ccode\u003estr.isdigit\u003c/code\u003e (You can create more complex filter function)\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token builtin\"\u003eint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e''\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejoin\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token builtin\"\u003efilter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eisdigit\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e sentence\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e100\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e10000\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cem\u003eActually here're many variation of these basis solutions with some changes.\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eFinally here're 2 possible solutions which fit for my case and requirements:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ereplace \u003cem\u003ebad\u003c/em\u003e chars, split string and check every part for numbers\u003c/li\u003e\n\u003cli\u003euse regex\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eNotes:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003efor my case I need to extract only first found number\u003c/li\u003e\n\u003cli\u003eI consider 3.14 == 3,14 in string and converts it to a number. That's not a standard approach.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eWith StackOverflow in hands most of us start coding just in time when possible solution is found. I try to create tests first.\nSo, lets create a test which allows us to evaluate solutions.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003etest_set \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"{% 152.2795837829749\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"{% 1608577297370\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"\u0026#x3C;#if 1608577297618 %%}\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"1608577297618 %%} 88912\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"788\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"89.981\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"n55b30\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"\u003e=123233333332324323\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"\u0026#x26;\u003e\u003e\u003e 1231\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"9000001\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"42\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"bba\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"!@#$%^\u0026#x26;*()231122223\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"-99,01\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"100,001.2000\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"what about very long string ? with a number - 2000.002??? \"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"and ever much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much much longer string 10990.2\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"!@#$%^\u0026#x26;*()_+\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"!@#$%^\u0026#x26;*()_+900.42!@#$%^\u0026#x26;*()_+!@#$%^\u0026#x26;*()_+!@#$%^\u0026#x26;*()_+iiiiiiEEEEE^^^^^\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\nexpected_result \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"token number\"\u003e152.2795837829749\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1608577297370\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1608577297618\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1608577297618\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token number\"\u003e788\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e89.981\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e55\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e123233333332324323\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1231\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e9000001\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e42\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token boolean\"\u003eNone\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e231122223\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token number\"\u003e99.01\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e100.001\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e2000.002\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e10990.2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eNone\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eNone\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e900.42\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003erun_test\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efn\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    l \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e s \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e test_set\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        l\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eappend\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efn\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003es\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e l \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e expected_result\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eI finished with 2 approaches\u003c/p\u003e\n\u003cp\u003e\u003cps1\u003eSolution 1\u003c/ps1\u003e - replace, split and append\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eStart with replacing chars which can be clumped with our number, then split string to list, go through each element of the list and try to convert these parts to a numbers - int or float.\u003c/em\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003esanitize_1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003es\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    l \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e t \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e s\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etranslate\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token builtin\"\u003eord\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ec\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\" \"\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e c \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^\u0026#x26;*()[]{};:/\u0026#x3C;\u003e?\\|`~=_+\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esplit\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            t \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e t\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ereplace\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e','\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'.'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token string\"\u003e'.'\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e t\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n                a1 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e t\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esplit\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'.'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                l\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eappend\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token builtin\"\u003efloat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'.'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejoin\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ea1\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n                l\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eappend\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token builtin\"\u003eint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003et\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ebreak\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eexcept\u003c/span\u003e ValueError\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003epass\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e l\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e l \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eNone\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cem\u003eThere's potential problem with this code - \u003ccode\u003esplit()\u003c/code\u003e might create huge list on complex strings and thus increases number of loops with all the stuff inside.\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cps1\u003eSolution 2\u003c/ps1\u003e use \u003cstrong\u003eRegEx\u003c/strong\u003e\nUsing of regex is considered to be a slightly bad practice.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003esanitize_2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003es\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    l \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n    l\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eextend\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token builtin\"\u003efloat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003et\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token string\"\u003e'.'\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e t \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003et\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e t \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e re\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efindall\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003er'[-]?\\d+(?:\\.\\d+)?'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e s\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ereplace\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e','\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'.'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e l\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e l \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eNone\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOkay, lets test them on performance. I'm using ipython cell magic \u003ccode\u003e%timeit\u003c/code\u003e as most simple way to evaluate performance\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token operator\"\u003e%\u003c/span\u003etimeit run_test\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esanitize_1\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e%\u003c/span\u003etimeit run_test\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esanitize_2\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token number\"\u003e236\u003c/span\u003e µs ± \u003cspan class=\"token number\"\u003e11.7\u003c/span\u003e µs per loop \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emean ± std\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e dev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e of \u003cspan class=\"token number\"\u003e7\u003c/span\u003e runs\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e10000\u003c/span\u003e loops each\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token number\"\u003e72.2\u003c/span\u003e µs ± \u003cspan class=\"token number\"\u003e1.12\u003c/span\u003e µs per loop \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emean ± std\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e dev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e of \u003cspan class=\"token number\"\u003e7\u003c/span\u003e runs\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e10000\u003c/span\u003e loops each\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eRegex approach is much faster, moover it's much shorter and simplier (sure if you know regex)\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/p1067/perl_problems_2x.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eThat's all, solution #2 won and was deployed\u003c/p\u003e\n","title":"Extract numbers from string in python with real life example","date":"2021-01-05T10:30:35+00:00","status":"unpublished","permalink":"/?p=1067","author":"pavel","type":"post","tag":["python","python3","benchmark"]}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"extract-numbers-from-string-in-python"},"buildId":"vTJdTKi8Gq_ea_DKcXzDG","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-83732ebf2ed7f8a1b2c7.js"></script><script src="/_next/static/chunks/main-d99e70035f31fbf26280.js" async=""></script><script src="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/_next/static/chunks/framework.ef157c678a62cfb2c073.js" async=""></script><script src="/_next/static/chunks/commons.0cd3f0b406132b99fef1.js" async=""></script><script src="/_next/static/chunks/pages/_app-f576db2e6f64d3b421e3.js" async=""></script><script src="/_next/static/chunks/b435696c38dfa3a566dd7089f731d08d7e0bf097.f940d483b5a1fae10b21.js" async=""></script><script src="/_next/static/chunks/1d62a1056678c2f23610de94ff6f49e06a569636.b588272bed0c9114d503.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-dd3e2b826f95ad4c71da.js" async=""></script><script src="/_next/static/vTJdTKi8Gq_ea_DKcXzDG/_buildManifest.js" async=""></script><script src="/_next/static/vTJdTKi8Gq_ea_DKcXzDG/_ssgManifest.js" async=""></script></body></html>