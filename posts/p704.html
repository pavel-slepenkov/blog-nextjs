<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><link rel="preload" href="https://unpkg.com/prismjs@0.0.1/themes/prism-tomorrow.css" as="script"/><link rel="preload" href="https://unpkg.com/prismjs@0.0.1/themes/prism-coy.css" as="script"/><link rel="preload" href="https://unpkg.com/prismjs@0.0.1/themes/prism-okaidia.css" as="script"/><link rel="preload" href="https://unpkg.com/prismjs@0.0.1/themes/prism-funky.css" as="script"/><link href="https://unpkg.com/prismjs@0.0.1/themes/prism-okaidia.css" rel="stylesheet"/><meta name="description" content="Pavel Slepenkov - developer"/><meta property="og:image" content="https://og-image.now.sh/Pavel%20Slepenkov%20personal%20blog.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fhyper-color-logo.svg&amp;widths=auto"/><meta name="og:title" content="Pavel Slepenkov personal blog"/><meta name="twitter:card" content="summary_large_image"/><title>Using Javascript promises within Lightning Components</title><meta name="next-head-count" content="13"/><link rel="preload" href="/blog-nextjs/_next/static/css/d9f62f5770aa60bc54db.css" as="style"/><link rel="stylesheet" href="/blog-nextjs/_next/static/css/d9f62f5770aa60bc54db.css" data-n-g=""/><link rel="preload" href="/blog-nextjs/_next/static/css/7b989d401051c7c1fc1a.css" as="style"/><link rel="stylesheet" href="/blog-nextjs/_next/static/css/7b989d401051c7c1fc1a.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/blog-nextjs/_next/static/chunks/main-a7c970f167496c3f3d8f.js" as="script"/><link rel="preload" href="/blog-nextjs/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/blog-nextjs/_next/static/chunks/framework.2113c6061a2f456066a1.js" as="script"/><link rel="preload" href="/blog-nextjs/_next/static/chunks/commons.390514621f46153c0d8a.js" as="script"/><link rel="preload" href="/blog-nextjs/_next/static/chunks/pages/_app-63f54fbe8fbe4d14dff9.js" as="script"/><link rel="preload" href="/blog-nextjs/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.c6af214380aa78d8cb3e.js" as="script"/><link rel="preload" href="/blog-nextjs/_next/static/chunks/pages/posts/%5Bid%5D-4c37b983192d656c52ce.js" as="script"/></head><body><div id="__next"><div class="layout_container__2t4v2"><header class="layout_header__2rhWq"><a href="/blog-nextjs"><img src="/images/sh.jpg" class="layout_headerImage__2h5On utils_borderCircle__13qdJ" alt="Pavel Slepenkov"/></a><h2 class="utils_headingLg__de7p0"><a class="utils_colorInherit__3Gudf" href="/blog-nextjs">Pavel Slepenkov</a></h2></header><main><article><h1 class="utils_headingXl__1XecN">Using Javascript promises within Lightning Components</h1><div class="utils_lightText__12Ckm"><time dateTime="2016-07-17T20:37:23+01:00">July 17, 2016</time></div><div><p>My new project requires a lot of javascript coding for Lightning component. Many books and guides about programming will teach you jsut a basics but all it seems like this picture</p>
<p><a href="http://www.pavelslepenkov.info/wp-content/uploads/2016/07/754a1def902e9d60cbd631184106d883.jpg"><img src="https://www.pavelslepenkov.info/wp-content/uploads/2016/07/754a1def902e9d60cbd631184106d883.jpg" alt="754a1def902e9d60cbd631184106d883"></a></p>
<p>Author will give you a very basic example of use and leaves you alone. Lightning Components developer guide does it. Actually when they teaching about using asynchronous javascript in Lightning they shows how to use <strong>action.setCallback</strong> for just one server action is you callback stack. But what should you do if you need to call server action, then analyse the response and based on this response to make another server callout or few? Probably you can write a some <em>callBack Hell</em> code.</p>
<p><a href="http://www.pavelslepenkov.info/wp-content/uploads/2016/07/promises-and-chaining-in-angularjs-into-callback-hell-and-back-again-17-638.jpg"><img src="https://www.pavelslepenkov.info/wp-content/uploads/2016/07/promises-and-chaining-in-angularjs-into-callback-hell-and-back-again-17-638.jpg" alt="promises-and-chaining-in-angularjs-into-callback-hell-and-back-again-17-638"></a></p>
<p>Something like that</p>
<p>[code lang=”js”]</p>
<p>var action = cmp.get("c.serverAction");
action.setCallback(this, function(response){
var state = response.getResponse();
if (state === "SUCCESS") {
if (response.getReturnValue() === someCheckedValue) {
var action2 = cmp.get("c.serverAction2");
action2.setCallback(this, function(response2) {
var state2 = response2.getResponse();
if (state2 === "SUCCESS") {
if (someCondition) {
var action3 = cmp.get("c.serverAction3");
action3.setCallback(this, function(response2) {
// you can check how deep the rabbit hole goes by adding a few callbacks
}}}}}}});
[/code]</p>
<p>I pretty sure that you found that such code will not be maintainable and flexible as you want. Actually when you add some business logic and error handling within these function you will find that you stack of callbacks takes a 150-200 LoC. Not so good.</p>
<p>Here’s a option of using <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Promise">JavaScript promises</a>. (<a href="https://davidwalsh.name/promises">David Walsh’s post</a>)</p>
<p>[code lang=”javascript”]</p>
<p>// CONTROLLER ——–
var someFunc = function() {
// runAsync is a function which returns Promise
runAsync().then(
function(response) {//onSuccess
if (response["status"] === 1) {
helper.callServerAction2(cmp);
} else if (response["status"] === 2) {
helper.callServerAction3(cmp);
} else if (response["status"] === 3) {
helper.callServerAction4(cmp);
helper.callServerAction5(cmp);
}
}, function(error) {
//onError console.error("Failed!", error);
});
}</p>
<p>// HELPER ——–</p>
<p>var runAsync = function(cmp) {
var action = cmp.get("c.serverAction");
// here’s a first trick – you need to call another helper method through this
// but in context of Promise ‘this’ will be different
var ltg = this;
return new Promise(function(resolve, reject){
// do some Asynchronous action here
action.setCallback(ltg, function(response) {
var state = response.getState();
ltg.callSomeHelpeMethodFromPromise();
if (state === "SUCCESS") {
resolve(action.getReturnValue());
} else {
reject(state);
}
});
});
}
[/code]</p>
<p>So, as you can see from the code above using of Promises makes your code much modular and flexible to change. This’s a reason why you need to use Promises in your code. If you using jQuery in your project you can see to <a href="https://api.jquery.com/category/deferred-object/">jQuery Deferred Objects</a> which does the same but have a little bit easy API.</p>
<p>Thanks for reading</p>
</div></article></main><div class="layout_backToHome__1vZsp"><a href="/blog-nextjs">← Back to home</a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"p704","contentHtml":"\u003cp\u003eMy new project requires a lot of javascript coding for Lightning component. Many books and guides about programming will teach you jsut a basics but all it seems like this picture\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://www.pavelslepenkov.info/wp-content/uploads/2016/07/754a1def902e9d60cbd631184106d883.jpg\"\u003e\u003cimg src=\"https://www.pavelslepenkov.info/wp-content/uploads/2016/07/754a1def902e9d60cbd631184106d883.jpg\" alt=\"754a1def902e9d60cbd631184106d883\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eAuthor will give you a very basic example of use and leaves you alone. Lightning Components developer guide does it. Actually when they teaching about using asynchronous javascript in Lightning they shows how to use \u003cstrong\u003eaction.setCallback\u003c/strong\u003e for just one server action is you callback stack. But what should you do if you need to call server action, then analyse the response and based on this response to make another server callout or few? Probably you can write a some \u003cem\u003ecallBack Hell\u003c/em\u003e code.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://www.pavelslepenkov.info/wp-content/uploads/2016/07/promises-and-chaining-in-angularjs-into-callback-hell-and-back-again-17-638.jpg\"\u003e\u003cimg src=\"https://www.pavelslepenkov.info/wp-content/uploads/2016/07/promises-and-chaining-in-angularjs-into-callback-hell-and-back-again-17-638.jpg\" alt=\"promises-and-chaining-in-angularjs-into-callback-hell-and-back-again-17-638\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eSomething like that\u003c/p\u003e\n\u003cp\u003e[code lang=”js”]\u003c/p\u003e\n\u003cp\u003evar action = cmp.get(\"c.serverAction\");\naction.setCallback(this, function(response){\nvar state = response.getResponse();\nif (state === \"SUCCESS\") {\nif (response.getReturnValue() === someCheckedValue) {\nvar action2 = cmp.get(\"c.serverAction2\");\naction2.setCallback(this, function(response2) {\nvar state2 = response2.getResponse();\nif (state2 === \"SUCCESS\") {\nif (someCondition) {\nvar action3 = cmp.get(\"c.serverAction3\");\naction3.setCallback(this, function(response2) {\n// you can check how deep the rabbit hole goes by adding a few callbacks\n}}}}}}});\n[/code]\u003c/p\u003e\n\u003cp\u003eI pretty sure that you found that such code will not be maintainable and flexible as you want. Actually when you add some business logic and error handling within these function you will find that you stack of callbacks takes a 150-200 LoC. Not so good.\u003c/p\u003e\n\u003cp\u003eHere’s a option of using \u003ca href=\"https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Promise\"\u003eJavaScript promises\u003c/a\u003e. (\u003ca href=\"https://davidwalsh.name/promises\"\u003eDavid Walsh’s post\u003c/a\u003e)\u003c/p\u003e\n\u003cp\u003e[code lang=”javascript”]\u003c/p\u003e\n\u003cp\u003e// CONTROLLER ——–\nvar someFunc = function() {\n// runAsync is a function which returns Promise\nrunAsync().then(\nfunction(response) {//onSuccess\nif (response[\"status\"] === 1) {\nhelper.callServerAction2(cmp);\n} else if (response[\"status\"] === 2) {\nhelper.callServerAction3(cmp);\n} else if (response[\"status\"] === 3) {\nhelper.callServerAction4(cmp);\nhelper.callServerAction5(cmp);\n}\n}, function(error) {\n//onError console.error(\"Failed!\", error);\n});\n}\u003c/p\u003e\n\u003cp\u003e// HELPER ——–\u003c/p\u003e\n\u003cp\u003evar runAsync = function(cmp) {\nvar action = cmp.get(\"c.serverAction\");\n// here’s a first trick – you need to call another helper method through this\n// but in context of Promise ‘this’ will be different\nvar ltg = this;\nreturn new Promise(function(resolve, reject){\n// do some Asynchronous action here\naction.setCallback(ltg, function(response) {\nvar state = response.getState();\nltg.callSomeHelpeMethodFromPromise();\nif (state === \"SUCCESS\") {\nresolve(action.getReturnValue());\n} else {\nreject(state);\n}\n});\n});\n}\n[/code]\u003c/p\u003e\n\u003cp\u003eSo, as you can see from the code above using of Promises makes your code much modular and flexible to change. This’s a reason why you need to use Promises in your code. If you using jQuery in your project you can see to \u003ca href=\"https://api.jquery.com/category/deferred-object/\"\u003ejQuery Deferred Objects\u003c/a\u003e which does the same but have a little bit easy API.\u003c/p\u003e\n\u003cp\u003eThanks for reading\u003c/p\u003e\n","title":"Using Javascript promises within Lightning Components","date":"2016-07-17T20:37:23+01:00","status":"publish","permalink":"/?p=704","author":"pavel","excerpt":"","type":"post","category":["force.com","javascript","salesforce.com"],"tag":["javascript","lightning","lightning components","promises","salesforce"],"post_format":[],"dsq_thread_id":["5587931328"]}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"p704"},"buildId":"TF6n2XRDf4AGCzKEuTXII","assetPrefix":"/blog-nextjs","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/blog-nextjs/_next/static/chunks/polyfills-11c8eba6a84e3fddec04.js"></script><script src="/blog-nextjs/_next/static/chunks/main-a7c970f167496c3f3d8f.js" async=""></script><script src="/blog-nextjs/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/blog-nextjs/_next/static/chunks/framework.2113c6061a2f456066a1.js" async=""></script><script src="/blog-nextjs/_next/static/chunks/commons.390514621f46153c0d8a.js" async=""></script><script src="/blog-nextjs/_next/static/chunks/pages/_app-63f54fbe8fbe4d14dff9.js" async=""></script><script src="/blog-nextjs/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.c6af214380aa78d8cb3e.js" async=""></script><script src="/blog-nextjs/_next/static/chunks/pages/posts/%5Bid%5D-4c37b983192d656c52ce.js" async=""></script><script src="/blog-nextjs/_next/static/TF6n2XRDf4AGCzKEuTXII/_buildManifest.js" async=""></script><script src="/blog-nextjs/_next/static/TF6n2XRDf4AGCzKEuTXII/_ssgManifest.js" async=""></script></body></html>