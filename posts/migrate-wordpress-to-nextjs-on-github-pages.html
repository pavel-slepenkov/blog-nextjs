<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><link href="https://unpkg.com/prismjs@1.23.0/themes/prism-okaidia.css" rel="stylesheet"/><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="description" content="Pavel Slepenkov&#x27;s personal blog: stories about BI, python, salesforce and data analysis"/><meta http-equiv="cache-control" content="Private"/><meta http-equiv="Expires" content="366000"/><meta property="og:locale" content="en_US"/><meta name="og:title" content="Pavel Slepenkov&#x27;s personal blog"/><meta property="og:description" content="stories about BI, python, salesforce and data analysis"/><meta property="og:type" content="article"/><meta property="og:site_name" content="pavelslepenkov.info"/><meta property="og:image" content="/og.png"/><meta name="twitter:title" content="Pavel Slepenkov&#x27;s personal blog"/><meta name="twitter:description" content="stories about BI, python, salesforce and data analysis"/><meta name="twitter:card" content="summary_large_image"/><meta property="twitter:image" content="/og.png"/><meta name="keywords" content="python, BI, sql, salesforce, data engineering, apex, soql, data analisys"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-63037633-1"></script><script>
                            window.dataLayer = window.dataLayer || [];
                            function gtag(){dataLayer.push(arguments);}
                            gtag('js', new Date());
                            gtag('config', 'UA-63037633-1');
                    </script><style>@import url(&#x27;https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300&amp;family=Spectral:wght@300;600&amp;display=swap&#x27;);</style><title>Migrate Wordpress blog to Next.js on Github pages - part 1</title><meta name="next-head-count" content="23"/><link rel="preload" href="/_next/static/css/36ece68f30a73b79.css" as="style"/><link rel="stylesheet" href="/_next/static/css/36ece68f30a73b79.css" data-n-g=""/><link rel="preload" href="/_next/static/css/38c3b924c786bb52.css" as="style"/><link rel="stylesheet" href="/_next/static/css/38c3b924c786bb52.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-ad45764ecfcae9e5.js" defer=""></script><script src="/_next/static/chunks/main-ee0cf4b7f81d7c24.js" defer=""></script><script src="/_next/static/chunks/pages/_app-2398585b21d2d8c8.js" defer=""></script><script src="/_next/static/chunks/105-51803cf0fd5a7825.js" defer=""></script><script src="/_next/static/chunks/358-14c60bb94e9d94b9.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-8c5a1f5b65ec0a5a.js" defer=""></script><script src="/_next/static/VJZxoreHuiV9pYg-4NjM6/_buildManifest.js" defer=""></script><script src="/_next/static/VJZxoreHuiV9pYg-4NjM6/_ssgManifest.js" defer=""></script></head><body class="centered"><script src="noflash.js"></script><script src="PathSolver.js"></script><div id="__next"><div class="layout_container__fbLkO"><div class="no-print"><header class="layout_header__kY0Lt"><div class="navbar-link"><a class="layout_devNull__CjwH1" href="/">Technical notes</a>‚Äî‚Äî‚Äî‚Äî‚Äî<a class="layout_devNull__CjwH1" href="/cv">CV</a>‚Äî‚Äî‚Äî‚Äî‚Äî<a class="layout_devNull__CjwH1" href="/books">Book reviews</a></div><div class="DarkModeToggle_darkModeToggle__m5z3H"><button type="button">üåû</button><button type="button">üåö</button></div></header></div><main><article><h1 class="utils_headingXl__u25Y2">Migrate Wordpress blog to Next.js on Github pages - part 1</h1><div class="utils_lightText__eUzGY"><time dateTime="2020-12-29T10:30:35+00:00">December 29, 2020</time></div><div><p>Wordpress is a way to go solution for many projects. I was using it for a many years in a different projects.
But when you're developer there's too much pain expecially for personal blog</p>
<ul>
<li>heaviness
<ul>
<li>pluging can make site very heavy to load</li>
<li>3rd party plugins with unknown components inside</li>
</ul>
</li>
<li>hosting &#x26; security
<ul>
<li>possible security issues and eternal port scaning. If you check server access logs you'll find port scanning almost every minute, ssh scanning</li>
<li>hosting payments. Not so big deal but anyway as I'll use GitHub pages for hosting this point is a small benifit.</li>
</ul>
</li>
<li>plugins vs coplicated customizations
<ul>
<li>when you need to add some simple functionality you have to use 3rd party plugin or make all the changes from scratch in PHP with all possible pitfalls on the way</li>
</ul>
</li>
</ul>
<p>This was my motivation to move to static site generators and GitHub pages. A quick look to the <a href="https://jamstack.org/generators/">landscape of SSG</a> brought me a few candidate - Next.js and Gatsby because the use Javascript and React. The choice was made by coin and Next.js won.</p>
<p>What are your benefits of using SSG?</p>
<ul>
<li>HTML - old good html, it's blazing fast. It will be highly reated by Google.</li>
<li>Markdown's driven post writing experience. That's fantastic when you can use your favorite text editor with all tricks you've learned over the years.</li>
<li>Absolute control over content and styling (which can be an issue on Wordpress after major releases of some plugins)</li>
</ul>
<p>Part 1 contains the following parts:</p>
<ul>
<li>Initial project's setup</li>
<li>Deploy to GitHub via <a href="https://github.com/features/actions">GirHub Actions</a></li>
<li>Some pain with data migration</li>
<li>Custom domain</li>
</ul>
<hr/>
<p><ps1><strong>1. Initial setup</strong></ps1> is pretty easy</p>
<p>1.1 setup GitHub repo to host your project.
2 options here - setup your personal/org repo on your-username.github.io or to enable GitHub pages inside other repo. I already had personal repo so I decided to create new one in separate repo.</p>
<p><img src="/images/p1066/gh-repo-setup.png" alt=""></p>
<p>Then you need to go to the repository's settings and select branch which contains publishing sources in <strong>GitHub Pages</strong> section.
In my case a <strong>master</strong> branch containts a nextjs code, markdown, resources, etc and <strong>gh-pages</strong> branch contains static html generated from sources in <strong>master</strong> branch. So select <strong>gh-pages</strong> and root folder. Here's <a href="https://docs.github.com/en/github/working-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site">official instruction</a>. As a result I got a site running under <strong>https://pavel-slepenkov.github.io/blog-nextjs</strong>.</p>
<p>1.2 Clone github repo to local machine</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> clone git@github.com:your-username/your-username.github.io.git
or
<span class="token function">git</span> clone git@github.com:your-username/repo-name.git
</code></pre></div>
<p>in case if you configure GitHub pages in other repo</p>
<p>1.3 To start working with Next.js I recommend to spend some time with <a href="https://nextjs.org/learn/basics/create-nextjs-app">official guide</a> (<em>Yes, you're right I just copied base tempate of the tutorial and use it for this blog ü§∑‚Äç‚ôÇÔ∏è</em>). Here's almost nothing to write about.</p>
<p>in short</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">cd</span> your-project-repo-local-folder
npx create-next-app src
<span class="token function">npm</span> run dev
</code></pre></div>
<p>now you can check <strong>http://localhost:3000</strong> and see
<img src="/images/p1066/next-js-start-page.png" alt=""></p>
<p>In this point I recommend to go though official guide and make some initial version of your site. Do not forget to add your changes to a version control from time to time.</p>
<hr/>
<p><ps1><strong>2. Deploy</strong></ps1> can be a kinda tricky if you was never working with <a href="https://github.com/features/actions">GitHub actions</a>.</p>
<p>2.1 create the following folder structure in your project's root directory in the same level with src folder</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash">.github/
‚îî‚îÄ‚îÄ workflows
    ‚îî‚îÄ‚îÄ main.yml
</code></pre></div>
<p><strong>main.yml</strong></p>
<div class="remark-highlight"><pre class="language-yml"><code class="language-yml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Build and Deploy
<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">push</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> master
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build-and-deploy</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">defaults</span><span class="token punctuation">:</span>
      <span class="token key atrule">run</span><span class="token punctuation">:</span>
        <span class="token key atrule">working-directory</span><span class="token punctuation">:</span> ./src

    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout üõéÔ∏è
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2.3.1
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">persist-credentials</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Cache  üíæ
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/cache@v2
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> github.workspace <span class="token punctuation">}</span><span class="token punctuation">}</span>/.next/cache
          <span class="token key atrule">key</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> runner.os <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span>nextjs<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">{</span> hashFiles('<span class="token important">**/package-lock.json')</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install and Build üîß
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="token scalar string">          npm install</span>
<span class="token scalar string">          npm run build</span>

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy üöÄ
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> JamesIves/github<span class="token punctuation">-</span>pages<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span>action@3.7.1
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">GITHUB_TOKEN</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.GITHUB_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">BRANCH</span><span class="token punctuation">:</span> gh<span class="token punctuation">-</span>pages <span class="token comment"># The branch the action should deploy to.</span>
          <span class="token key atrule">FOLDER</span><span class="token punctuation">:</span> src/out <span class="token comment"># The folder the action should deploy.</span>
          <span class="token key atrule">CLEAN</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># Automatically remove deleted files from the deploy branch</span>
</code></pre></div>
<p>The build contains 4 steps:</p>
<ul>
<li><ps3>Checkout</ps3> sources from master branch (do not forget to change it to name of branch which you use as default)</li>
<li><ps3>Cache</ps3> action allows caching dependencies and build outputs to improve workflow execution time.</li>
<li><ps3>Install and Build</ps3> just run npm commands.</li>
<li><ps3>Deploy</ps3> automatically deploys your project to GitHub Pages. I highly recommend to check out this project's <a href="https://github.com/JamesIves/github-pages-deploy-action">home page</a> and read the docs. It has many options which can be useful.</li>
</ul>
<p>2.2 tune <strong>package.json</strong></p>
<p>when you created a project with npx <strong>package.json</strong> looks like that</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token punctuation">{</span>
  <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"src"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token string">"0.1.0"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"private"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string-property property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">"dev"</span><span class="token operator">:</span> <span class="token string">"next dev"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"build"</span><span class="token operator">:</span> <span class="token string">"next build"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"start"</span><span class="token operator">:</span> <span class="token string">"next start"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">"next"</span><span class="token operator">:</span> <span class="token string">"10.0.5"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"react"</span><span class="token operator">:</span> <span class="token string">"17.0.1"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"17.0.1"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>but GitHub deployment requires some tuning in build step</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token string-property property">"build"</span><span class="token operator">:</span> <span class="token string">"next build &#x26;&#x26; next export &#x26;&#x26; touch out/.nojekyll"</span><span class="token punctuation">,</span>
</code></pre></div>
<p>lets check each step here</p>
<ul>
<li><code>next build</code> builds the production application</li>
<li><code>next export</code> allows you to export your app to static HTML, which can be run standalone without the need of a Node.js server. That's just what we want.</li>
<li><code>touch out/.nojekyll</code> creates file which required for bypassing Jekyll processing on GitHub Pages. This's necessary if your site uses files or directories that start with underscores since Jekyll considers these to be special resources and does not copy them to the final site.</li>
</ul>
<p><em>You can also create .nojekyll file directly in gh-pages branch and github-pages-deploy-action should not to remove/rewrite it.</em></p>
<p>After all you can commit these changes and push it to GitHub. If you did all the steps in correct way you will find GitHub Action running in your repo</p>
<p><img src="/images/p1066/im1.png" alt=""></p>
<p>And withing 2 minutes you'll get your site up and running.</p>
<hr/>
<p><ps1>3. But what about migration?</ps1></p>
<p><em>Yeah, you need to migrate a content and might be styles and functionality of your initial site.</em></p>
<p>For data migration I used <a href="https://github.com/tinacms/wp-gatsby-markdown-exporter">WP-Gatsby Markdown Exporter plugin</a>. It allows me to download all data from my Wordpress site as archive with markdown files for posts and pages, images. To be honest that's no a very convenient way because this markdown might be corrupted in many places. Mostly for code formatted with some funcy wordpress plugin. But anyway that's a good start. I moved all markdown files into posts catalog and just pushed it to GitHub. In just a five minutes I had all posts hosted on new blog. Yes, it required a fixes and I spent some time on it as well as moving images to correct location and linking it with posts. As I have not so many posts on my blog this was not a big deal. If you have hundreds or thouthands of posts it might be real headache and I'd recommend to research for more advanced option for moving content. It might be a more advanced wp - markdown migration plugin, or it might be that you will create some script which automate this routine job. Anyway your content is differ and you need to find your own approach to this.</p>
<p>Style and functionality migrations are out of scope of this post. But if you start with SSG I believe you can code and it's not a big deal to move styling. I'll cover some such things in part 2.</p>
<hr/>
<p><ps1>4. Custom domain</ps1></p>
<p>It's pretty easy part because there's a <a href="https://docs.github.com/en/github/working-with-github-pages/managing-a-custom-domain-for-your-github-pages-site">good official documentation</a></p>
<ul>
<li>
<p>Configure repo to use custom domain
<img src="/images/p1066/gh-repo-setup-custom-domain.png" alt="custom domain setup">
Note <strong>Enforce HTTPS</strong> checkbox</p>
</li>
<li>
<p>Configure DNS
<img src="/images/p1066/godaddy.png" alt="DNS config"></p>
</li>
<li>
<p>Add CNAME file which contains domain name to your repository. In my case this file must be in <strong>gh-pages</strong> branch. You can directly commit this file or add one more command to build step <code>&#x26;&#x26; echo 'pavelslepenkov.info' >> out/CNAME</code></p>
</li>
</ul>
<p>Wait some time for DNS update. Check your site on http:// and https:// version. Than check https://www.yourdomain.com and cry because most probably it will show some sort privacy error.
To overcome this I did a trick (<em>I hope it will help you too, but github can change anything in it's enginee in future</em>)</p>
<ol>
<li>add www. in custom domain setup and save. Enforce HTTPS can be unckeckable in this point.</li>
<li>wait until your site start to respond to www. subdomain</li>
<li>roll back changes in github setup and set domain to version withou www, check Enforce HTTPS.</li>
</ol>
<hr/>
<p>Finally my project structure looks like that
<strong>master branch</strong> which contains all the code
<img src="/images/p1066/master-branch.png" alt=""></p>
<p><strong>gh-pages branch</strong> which contains statically generated version which hosted on Github pages
<img src="/images/p1066/gh-pages-branch.png" alt=""></p>
<p>That's all for today</p>
</div></article><div><span class="utils_tag__r8GDN"><a href="/tag/nextjs">[<!-- -->nextjs<!-- -->]</a></span><span class="utils_tag__r8GDN"><a href="/tag/wordpress">[<!-- -->wordpress<!-- -->]</a></span><span class="utils_tag__r8GDN"><a href="/tag/javascript">[<!-- -->javascript<!-- -->]</a></span><span class="utils_tag__r8GDN"><a href="/tag/github">[<!-- -->github<!-- -->]</a></span><span class="utils_tag__r8GDN"><a href="/tag/GitHub-Actions">[<!-- -->GitHub Actions<!-- -->]</a></span></div></main><div class="layout_backToHome__9sjx_"><a href="/">‚áê back to home</a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"migrate-wordpress-to-nextjs-on-github-pages","contentHtml":"\u003cp\u003eWordpress is a way to go solution for many projects. I was using it for a many years in a different projects.\nBut when you're developer there's too much pain expecially for personal blog\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eheaviness\n\u003cul\u003e\n\u003cli\u003epluging can make site very heavy to load\u003c/li\u003e\n\u003cli\u003e3rd party plugins with unknown components inside\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ehosting \u0026#x26; security\n\u003cul\u003e\n\u003cli\u003epossible security issues and eternal port scaning. If you check server access logs you'll find port scanning almost every minute, ssh scanning\u003c/li\u003e\n\u003cli\u003ehosting payments. Not so big deal but anyway as I'll use GitHub pages for hosting this point is a small benifit.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eplugins vs coplicated customizations\n\u003cul\u003e\n\u003cli\u003ewhen you need to add some simple functionality you have to use 3rd party plugin or make all the changes from scratch in PHP with all possible pitfalls on the way\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThis was my motivation to move to static site generators and GitHub pages. A quick look to the \u003ca href=\"https://jamstack.org/generators/\"\u003elandscape of SSG\u003c/a\u003e brought me a few candidate - Next.js and Gatsby because the use Javascript and React. The choice was made by coin and Next.js won.\u003c/p\u003e\n\u003cp\u003eWhat are your benefits of using SSG?\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eHTML - old good html, it's blazing fast. It will be highly reated by Google.\u003c/li\u003e\n\u003cli\u003eMarkdown's driven post writing experience. That's fantastic when you can use your favorite text editor with all tricks you've learned over the years.\u003c/li\u003e\n\u003cli\u003eAbsolute control over content and styling (which can be an issue on Wordpress after major releases of some plugins)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003ePart 1 contains the following parts:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eInitial project's setup\u003c/li\u003e\n\u003cli\u003eDeploy to GitHub via \u003ca href=\"https://github.com/features/actions\"\u003eGirHub Actions\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eSome pain with data migration\u003c/li\u003e\n\u003cli\u003eCustom domain\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr/\u003e\n\u003cp\u003e\u003cps1\u003e\u003cstrong\u003e1. Initial setup\u003c/strong\u003e\u003c/ps1\u003e is pretty easy\u003c/p\u003e\n\u003cp\u003e1.1 setup GitHub repo to host your project.\n2 options here - setup your personal/org repo on your-username.github.io or to enable GitHub pages inside other repo. I already had personal repo so I decided to create new one in separate repo.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/p1066/gh-repo-setup.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eThen you need to go to the repository's settings and select branch which contains publishing sources in \u003cstrong\u003eGitHub Pages\u003c/strong\u003e section.\nIn my case a \u003cstrong\u003emaster\u003c/strong\u003e branch containts a nextjs code, markdown, resources, etc and \u003cstrong\u003egh-pages\u003c/strong\u003e branch contains static html generated from sources in \u003cstrong\u003emaster\u003c/strong\u003e branch. So select \u003cstrong\u003egh-pages\u003c/strong\u003e and root folder. Here's \u003ca href=\"https://docs.github.com/en/github/working-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site\"\u003eofficial instruction\u003c/a\u003e. As a result I got a site running under \u003cstrong\u003ehttps://pavel-slepenkov.github.io/blog-nextjs\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003e1.2 Clone github repo to local machine\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e\u003cspan class=\"token function\"\u003egit\u003c/span\u003e clone git@github.com:your-username/your-username.github.io.git\nor\n\u003cspan class=\"token function\"\u003egit\u003c/span\u003e clone git@github.com:your-username/repo-name.git\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ein case if you configure GitHub pages in other repo\u003c/p\u003e\n\u003cp\u003e1.3 To start working with Next.js I recommend to spend some time with \u003ca href=\"https://nextjs.org/learn/basics/create-nextjs-app\"\u003eofficial guide\u003c/a\u003e (\u003cem\u003eYes, you're right I just copied base tempate of the tutorial and use it for this blog ü§∑‚Äç‚ôÇÔ∏è\u003c/em\u003e). Here's almost nothing to write about.\u003c/p\u003e\n\u003cp\u003ein short\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e\u003cspan class=\"token builtin class-name\"\u003ecd\u003c/span\u003e your-project-repo-local-folder\nnpx create-next-app src\n\u003cspan class=\"token function\"\u003enpm\u003c/span\u003e run dev\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003enow you can check \u003cstrong\u003ehttp://localhost:3000\u003c/strong\u003e and see\n\u003cimg src=\"/images/p1066/next-js-start-page.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eIn this point I recommend to go though official guide and make some initial version of your site. Do not forget to add your changes to a version control from time to time.\u003c/p\u003e\n\u003chr/\u003e\n\u003cp\u003e\u003cps1\u003e\u003cstrong\u003e2. Deploy\u003c/strong\u003e\u003c/ps1\u003e can be a kinda tricky if you was never working with \u003ca href=\"https://github.com/features/actions\"\u003eGitHub actions\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003e2.1 create the following folder structure in your project's root directory in the same level with src folder\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e.github/\n‚îî‚îÄ‚îÄ workflows\n    ‚îî‚îÄ‚îÄ main.yml\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cstrong\u003emain.yml\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-yml\"\u003e\u003ccode class=\"language-yml\"\u003e\u003cspan class=\"token key atrule\"\u003ename\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e Build and Deploy\n\u003cspan class=\"token key atrule\"\u003eon\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"token key atrule\"\u003epush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token key atrule\"\u003ebranches\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003e master\n\u003cspan class=\"token key atrule\"\u003ejobs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"token key atrule\"\u003ebuild-and-deploy\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token key atrule\"\u003eruns-on\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e ubuntu\u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003elatest\n    \u003cspan class=\"token key atrule\"\u003edefaults\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"token key atrule\"\u003erun\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token key atrule\"\u003eworking-directory\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e ./src\n\n    \u003cspan class=\"token key atrule\"\u003esteps\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003e \u003cspan class=\"token key atrule\"\u003ename\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e Checkout üõéÔ∏è\n        \u003cspan class=\"token key atrule\"\u003euses\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e actions/checkout@v2.3.1\n        \u003cspan class=\"token key atrule\"\u003ewith\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"token key atrule\"\u003epersist-credentials\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean important\"\u003efalse\u003c/span\u003e\n\n      \u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003e \u003cspan class=\"token key atrule\"\u003ename\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e Cache  üíæ\n        \u003cspan class=\"token key atrule\"\u003euses\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e actions/cache@v2\n        \u003cspan class=\"token key atrule\"\u003ewith\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"token key atrule\"\u003epath\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e $\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e github.workspace \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e/.next/cache\n          \u003cspan class=\"token key atrule\"\u003ekey\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e $\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e runner.os \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003enextjs\u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003e$\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e hashFiles('\u003cspan class=\"token important\"\u003e**/package-lock.json')\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n      \u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003e \u003cspan class=\"token key atrule\"\u003ename\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e Install and Build üîß\n        \u003cspan class=\"token key atrule\"\u003erun\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e|\u003c/span\u003e\u003cspan class=\"token scalar string\"\u003e\u003c/span\u003e\n\u003cspan class=\"token scalar string\"\u003e          npm install\u003c/span\u003e\n\u003cspan class=\"token scalar string\"\u003e          npm run build\u003c/span\u003e\n\n      \u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003e \u003cspan class=\"token key atrule\"\u003ename\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e Deploy üöÄ\n        \u003cspan class=\"token key atrule\"\u003euses\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e JamesIves/github\u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003epages\u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003edeploy\u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003eaction@3.7.1\n        \u003cspan class=\"token key atrule\"\u003ewith\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"token key atrule\"\u003eGITHUB_TOKEN\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e $\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e secrets.GITHUB_TOKEN \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n          \u003cspan class=\"token key atrule\"\u003eBRANCH\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e gh\u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003epages \u003cspan class=\"token comment\"\u003e# The branch the action should deploy to.\u003c/span\u003e\n          \u003cspan class=\"token key atrule\"\u003eFOLDER\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e src/out \u003cspan class=\"token comment\"\u003e# The folder the action should deploy.\u003c/span\u003e\n          \u003cspan class=\"token key atrule\"\u003eCLEAN\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean important\"\u003etrue\u003c/span\u003e \u003cspan class=\"token comment\"\u003e# Automatically remove deleted files from the deploy branch\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe build contains 4 steps:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cps3\u003eCheckout\u003c/ps3\u003e sources from master branch (do not forget to change it to name of branch which you use as default)\u003c/li\u003e\n\u003cli\u003e\u003cps3\u003eCache\u003c/ps3\u003e action allows caching dependencies and build outputs to improve workflow execution time.\u003c/li\u003e\n\u003cli\u003e\u003cps3\u003eInstall and Build\u003c/ps3\u003e just run npm commands.\u003c/li\u003e\n\u003cli\u003e\u003cps3\u003eDeploy\u003c/ps3\u003e automatically deploys your project to GitHub Pages. I highly recommend to check out this project's \u003ca href=\"https://github.com/JamesIves/github-pages-deploy-action\"\u003ehome page\u003c/a\u003e and read the docs. It has many options which can be useful.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e2.2 tune \u003cstrong\u003epackage.json\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003ewhen you created a project with npx \u003cstrong\u003epackage.json\u003c/strong\u003e looks like that\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token string-property property\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"src\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token string-property property\"\u003e\"version\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"0.1.0\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token string-property property\"\u003e\"private\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token string-property property\"\u003e\"scripts\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token string-property property\"\u003e\"dev\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"next dev\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string-property property\"\u003e\"build\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"next build\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string-property property\"\u003e\"start\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"next start\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token string-property property\"\u003e\"dependencies\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token string-property property\"\u003e\"next\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"10.0.5\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string-property property\"\u003e\"react\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"17.0.1\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string-property property\"\u003e\"react-dom\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"17.0.1\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ebut GitHub deployment requires some tuning in build step\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token string-property property\"\u003e\"build\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"next build \u0026#x26;\u0026#x26; next export \u0026#x26;\u0026#x26; touch out/.nojekyll\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003elets check each step here\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003enext build\u003c/code\u003e builds the production application\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003enext export\u003c/code\u003e allows you to export your app to static HTML, which can be run standalone without the need of a Node.js server. That's just what we want.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003etouch out/.nojekyll\u003c/code\u003e creates file which required for bypassing Jekyll processing on GitHub Pages. This's necessary if your site uses files or directories that start with underscores since Jekyll considers these to be special resources and does not copy them to the final site.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cem\u003eYou can also create .nojekyll file directly in gh-pages branch and github-pages-deploy-action should not to remove/rewrite it.\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eAfter all you can commit these changes and push it to GitHub. If you did all the steps in correct way you will find GitHub Action running in your repo\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/p1066/im1.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eAnd withing 2 minutes you'll get your site up and running.\u003c/p\u003e\n\u003chr/\u003e\n\u003cp\u003e\u003cps1\u003e3. But what about migration?\u003c/ps1\u003e\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eYeah, you need to migrate a content and might be styles and functionality of your initial site.\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eFor data migration I used \u003ca href=\"https://github.com/tinacms/wp-gatsby-markdown-exporter\"\u003eWP-Gatsby Markdown Exporter plugin\u003c/a\u003e. It allows me to download all data from my Wordpress site as archive with markdown files for posts and pages, images. To be honest that's no a very convenient way because this markdown might be corrupted in many places. Mostly for code formatted with some funcy wordpress plugin. But anyway that's a good start. I moved all markdown files into posts catalog and just pushed it to GitHub. In just a five minutes I had all posts hosted on new blog. Yes, it required a fixes and I spent some time on it as well as moving images to correct location and linking it with posts. As I have not so many posts on my blog this was not a big deal. If you have hundreds or thouthands of posts it might be real headache and I'd recommend to research for more advanced option for moving content. It might be a more advanced wp - markdown migration plugin, or it might be that you will create some script which automate this routine job. Anyway your content is differ and you need to find your own approach to this.\u003c/p\u003e\n\u003cp\u003eStyle and functionality migrations are out of scope of this post. But if you start with SSG I believe you can code and it's not a big deal to move styling. I'll cover some such things in part 2.\u003c/p\u003e\n\u003chr/\u003e\n\u003cp\u003e\u003cps1\u003e4. Custom domain\u003c/ps1\u003e\u003c/p\u003e\n\u003cp\u003eIt's pretty easy part because there's a \u003ca href=\"https://docs.github.com/en/github/working-with-github-pages/managing-a-custom-domain-for-your-github-pages-site\"\u003egood official documentation\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eConfigure repo to use custom domain\n\u003cimg src=\"/images/p1066/gh-repo-setup-custom-domain.png\" alt=\"custom domain setup\"\u003e\nNote \u003cstrong\u003eEnforce HTTPS\u003c/strong\u003e checkbox\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eConfigure DNS\n\u003cimg src=\"/images/p1066/godaddy.png\" alt=\"DNS config\"\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eAdd CNAME file which contains domain name to your repository. In my case this file must be in \u003cstrong\u003egh-pages\u003c/strong\u003e branch. You can directly commit this file or add one more command to build step \u003ccode\u003e\u0026#x26;\u0026#x26; echo 'pavelslepenkov.info' \u003e\u003e out/CNAME\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eWait some time for DNS update. Check your site on http:// and https:// version. Than check https://www.yourdomain.com and cry because most probably it will show some sort privacy error.\nTo overcome this I did a trick (\u003cem\u003eI hope it will help you too, but github can change anything in it's enginee in future\u003c/em\u003e)\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eadd www. in custom domain setup and save. Enforce HTTPS can be unckeckable in this point.\u003c/li\u003e\n\u003cli\u003ewait until your site start to respond to www. subdomain\u003c/li\u003e\n\u003cli\u003eroll back changes in github setup and set domain to version withou www, check Enforce HTTPS.\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr/\u003e\n\u003cp\u003eFinally my project structure looks like that\n\u003cstrong\u003emaster branch\u003c/strong\u003e which contains all the code\n\u003cimg src=\"/images/p1066/master-branch.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003egh-pages branch\u003c/strong\u003e which contains statically generated version which hosted on Github pages\n\u003cimg src=\"/images/p1066/gh-pages-branch.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eThat's all for today\u003c/p\u003e\n","title":"Migrate Wordpress blog to Next.js on Github pages - part 1","date":"2020-12-29T10:30:35+00:00","permalink":"/?p=1066","author":"pavel","type":"post","tag":["nextjs","wordpress","javascript","github","GitHub Actions"],"post_format":[]}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"migrate-wordpress-to-nextjs-on-github-pages"},"buildId":"VJZxoreHuiV9pYg-4NjM6","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>