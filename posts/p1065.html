<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><link href="https://unpkg.com/prismjs@1.23.0/themes/prism-okaidia.css" rel="stylesheet"/><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="description" content="Pavel Slepenkov&#x27;s personal blog: stories about BI, python, salesforce and data analysis"/><meta http-equiv="cache-control" content="Private"/><meta http-equiv="Expires" content="366000"/><meta property="og:locale" content="en_US"/><meta name="og:title" content="Pavel Slepenkov&#x27;s personal blog"/><meta property="og:description" content="stories about BI, python, salesforce and data analysis"/><meta property="og:type" content="article"/><meta property="og:site_name" content="pavelslepenkov.info"/><meta property="og:image" content="/og.png"/><meta name="twitter:title" content="Pavel Slepenkov&#x27;s personal blog"/><meta name="twitter:description" content="stories about BI, python, salesforce and data analysis"/><meta name="twitter:card" content="summary_large_image"/><meta property="twitter:image" content="/og.png"/><meta name="keywords" content="python, BI, salesforce, data engineering, apex, sql, soql, data analisys"/><meta name="yandex-verification" content="35a3887ea995a4c4"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-63037633-1"></script><script>
                            window.dataLayer = window.dataLayer || [];
                            function gtag(){dataLayer.push(arguments);}
                            gtag('js', new Date());
                            gtag('config', 'UA-63037633-1');
                    </script><style>@import url(&#x27;https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300&amp;family=Spectral:wght@300&amp;display=swap&#x27;);</style><title>Google Cloud Functions for external testing of salesforce API endpoints</title><meta name="next-head-count" content="24"/><link rel="preload" href="/_next/static/css/4eebb272be199656919e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4eebb272be199656919e.css" data-n-g=""/><link rel="preload" href="/_next/static/css/6dce80f39b6e217927f5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6dce80f39b6e217927f5.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-a7c970f167496c3f3d8f.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.ef157c678a62cfb2c073.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.0cd3f0b406132b99fef1.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-239e31d52738f7fd2278.js" as="script"/><link rel="preload" href="/_next/static/chunks/1d62a1056678c2f23610de94ff6f49e06a569636.2116ac35632db79554b8.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bid%5D-f26bd131465ef7dfa7da.js" as="script"/></head><body><script src="noflash.js"></script><script src="PathSolver.js"></script><div id="__next"><div class="layout_container__2t4v2"><header class="layout_header__2rhWq"><div class="navbar-link"><a class="layout_devNull__6Fs9d" href="/">$ /dev/null</a>———<a class="layout_devNull__6Fs9d" href="/about">About </a>———<a class="layout_devNull__6Fs9d" href="https://pavel-slepenkov.github.io">Projects</a></div><div class="DarkModeToggle_darkModeToggle__2u4u3"><button type="button">☀</button><toggle></toggle><button type="button">☾</button></div></header><main><article><h1 class="utils_headingXl__1XecN">Google Cloud Functions for external testing of salesforce API endpoints</h1><div class="utils_lightText__12Ckm"><time dateTime="2019-12-27T11:30:35+00:00">December 27, 2019</time></div><div><p>This will be some sort of unique use case which most of you will never meet in production but there’s a chance it might be useful for someone as is. Also it might be converted to more useful anonymous webform collecting variant.</p>
<p>Imagine a case when you have to <strong>give the access to salesforce to someone on the 3rd part without giving actual salesforce credentials</strong>. You can call it anonymous access. My case was a scenario when I developed a sophisticated integration with external system (<a href="https://en.wikipedia.org/wiki/1C_Company">1C:Enterprise platform</a>) which must be run by a scheduler. But for <strong>testing purposes</strong> I had to give the ability to fire callout from Salesforce to 1C for an external developer who made a stuff on 1C part. Usually you perform such testing by yourself as it’s your part of integration. But he need to run this invocation too in order to profile his code. It looks that I can do it for him by request but he need to do that as many times as he want and when he want. Also final testing between all systems should be done on Salesforce production data with UAT 1C environment which will be converted to production version right after successful testing.</p>
<p>When I was thinking about possible solution I discovered a several ways to do this:</p>
<ul>
<li>Create a temporary user in Salesforce for the external developer and allow him to run apex command via developer console</li>
<li>Expose VF/Lightning page with button to invoke apex code via community/site</li>
<li>Expose REST service via community/site</li>
<li>Create a proxy service which can be invoked from external and run inside this service a code with my personal credentials</li>
</ul>
<p>Solution with user creation was too bad in security. I prefer to not give credentials to someone external if it’s not required for a business task.</p>
<p>Dedicated page required controller code, page and community/site + guest user profile configuration to expose it.</p>
<p>REST service exposed via site/community also requires community/site + guest user profile configuration.</p>
<p>So the last one seems most simple to me in terms of moving parts which has to be created.</p>
<p>The final solution looks like that</p>
<p><img src="/images/p1065/p3.png" alt=""></p>
<p>Production integration still aimed to be working by scheduler and the testing application requires 2 parts:</p>
<ul>
<li>Salesforce REST endpoint</li>
<li>Google Cloud function</li>
</ul>
<p><strong>Apex RESTS endpoint</strong> is very simple</p>
<div class="remark-highlight"><pre class="language-java"><code class="language-java"><span class="token annotation punctuation">@RestResource</span><span class="token punctuation">(</span>urlMapping<span class="token operator">=</span><span class="token string">'/testing-service'</span><span class="token punctuation">)</span>
    global <span class="token keyword">class</span> <span class="token class-name">Test1CIntegration</span> <span class="token punctuation">{</span>
        <span class="token comment">// you know what to do with params</span>
        <span class="token comment">// generate params list, dynamics queries, proxy param</span>
        <span class="token comment">// to the external system as request header / param / body</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&#x3C;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> requestJSON<span class="token punctuation">;</span>

        <span class="token annotation punctuation">@HttpGet</span>
        global <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getInvoicesInJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">handleRequestParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// do someting with requestJSON</span>
            <span class="token keyword">return</span> JSON<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>query<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                <span class="token class-name">WHERE</span> someField1 <span class="token operator">=</span><span class="token operator">:</span> param1
                <span class="token class-name">AND</span> someField2 <span class="token operator">=</span><span class="token operator">:</span> param2
                AND <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>etc<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@HttpPost</span>
        global <span class="token keyword">static</span> <span class="token class-name">SomeCoolWrapperClassObject</span> <span class="token function">sendInvoicesTo1C</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">handleRequestParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// do someting with requestJSON</span>
            <span class="token comment">// actually send data and return 1C response</span>
            <span class="token keyword">return</span> <span class="token function">sendInvoicesTo1C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">handleRequestParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            requestJSON <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&#x3C;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> JSON<span class="token punctuation">.</span><span class="token function">deserializeUntyped</span><span class="token punctuation">(</span><span class="token class-name">RestContext</span><span class="token punctuation">.</span>request<span class="token punctuation">.</span>requestBody<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> requestJSON<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// generate params as you want</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div>
<p><strong>The next part is Google Cloud Function</strong>. Instead of it you can use Amazon Lambda or any other similar product. I opted for Google Cloud just in order to practice with it.</p>
<p>So, let’s do it. First you need a <a href="https://cloud.google.com/">Google Cloud Platform</a> account. You will easily setup it by yourself. After setup just find out <strong>Cloud Functions</strong> in menu and go to it</p>
<p><img src="/images/p1065/i4.png" alt=""></p>
<p>Use <strong>HTTP trigger</strong>, it gives you an url which 3rd party person can use to invoke your code with <strong>curl</strong> or <strong>Postman</strong> or any other client tool for making requests (even web browser)</p>
<p><img src="/images/p1065/image-831x1024.png" alt=""></p>
<p>Then add required libraries via requirements.txt</p>
<p><img src="/images/p1065/image-1.png" alt=""></p>
<p>I use <strong><a href="https://github.com/psf/requests">requests</a></strong> for performing actual requests to Salesforce
and <code>simple-salesforce</code> in order to login and get session id. Actually you can do all the stuff with <a href="https://github.com/simple-salesforce/simple-salesforce">simple-salesforce </a></p>
<p>add code to <strong>main.py</strong></p>
<div class="remark-highlight"><pre class="language-python"><code class="language-python"><span class="token comment"># main.py</span>
<span class="token keyword">from</span> simple_salesforce <span class="token keyword">import</span> Salesforce
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> datetime
<span class="token keyword">import</span> json


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>initial_request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sf_url <span class="token operator">=</span> <span class="token string">'https://myorg.my.salesforce.com/services/apexrest/testing-service'</span>
    <span class="token comment"># request made by 3rd party user</span>
    <span class="token comment"># you can put configuration parameters in here</span>
    <span class="token comment"># and pass the to Salesforce</span>
    request_json <span class="token operator">=</span> initial_request<span class="token punctuation">.</span>get_json<span class="token punctuation">(</span><span class="token punctuation">)</span>
    headers <span class="token operator">=</span> sf_login<span class="token punctuation">(</span><span class="token punctuation">)</span>
    http_method <span class="token operator">=</span> <span class="token string">'GET'</span>
    <span class="token keyword">if</span> request_json <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        http_method <span class="token operator">=</span> <span class="token string">'POST'</span>
    sf_response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span>
        http_method<span class="token punctuation">,</span> url<span class="token operator">=</span>sf_url<span class="token punctuation">,</span> json<span class="token operator">=</span>request_json<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    <span class="token comment"># return SF response to a client</span>
    <span class="token keyword">return</span> <span class="token string">"Test sync run at "</span> <span class="token operator">+</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>utcnow<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" (UTC)"</span> <span class="token operator">+</span> <span class="token string">"\n Salesforce Response: "</span> <span class="token operator">+</span> sf_response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">sf_login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># login to Salesforce</span>
    salesforce <span class="token operator">=</span> Salesforce<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">'username'</span><span class="token punctuation">,</span>
                            password<span class="token operator">=</span><span class="token string">'pass'</span><span class="token punctuation">,</span>
                            security_token<span class="token operator">=</span><span class="token string">'token'</span><span class="token punctuation">,</span>
                            instance<span class="token operator">=</span><span class="token string">'https://myorg.my.salesforce.com'</span><span class="token punctuation">,</span>
                            sandbox<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                            version<span class="token operator">=</span><span class="token string">'47.0'</span><span class="token punctuation">)</span>
    <span class="token comment"># get session id and return it as auth header</span>
    session_id <span class="token operator">=</span> salesforce<span class="token punctuation">.</span>session_id<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"!"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"Authorization"</span><span class="token punctuation">:</span> <span class="token string">"Bearer "</span> <span class="token operator">+</span> session_id<span class="token punctuation">}</span>

</code></pre></div>
<p>click create and that’s it. You cloud function ready to run. You’re so serverless!</p>
<p>Now external developer can use terminal with curl or Postman to perform request to your cloud function which fire SF integration</p>
<p><code>curl -X POST "https://us-central1-sftest-999.cloudfunctions.net/integration-1C-test"     -H "Content-Type:application/json"     --data '{"docType":"Invoice", "invoiceNumber": "i-9999"}'</code></p>
<p>You can also easily modify this code in order to run some anonymous form collection. You just need a form which will be hosted somewhere and use this proxy to post data to Salesforce.</p>
</div></article><div><span class="utils_tag__38-Vr"><a href="/tag/apex">[<!-- -->apex<!-- -->]</a></span><span class="utils_tag__38-Vr"><a href="/tag/google-cloud-functions">[<!-- -->google cloud functions<!-- -->]</a></span><span class="utils_tag__38-Vr"><a href="/tag/google-cloud-platform">[<!-- -->google cloud platform<!-- -->]</a></span><span class="utils_tag__38-Vr"><a href="/tag/integration">[<!-- -->integration<!-- -->]</a></span><span class="utils_tag__38-Vr"><a href="/tag/serverless">[<!-- -->serverless<!-- -->]</a></span></div></main><div class="layout_backToHome__1vZsp"><a href="/">⇐ back to home</a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"p1065","contentHtml":"\u003cp\u003eThis will be some sort of unique use case which most of you will never meet in production but there’s a chance it might be useful for someone as is. Also it might be converted to more useful anonymous webform collecting variant.\u003c/p\u003e\n\u003cp\u003eImagine a case when you have to \u003cstrong\u003egive the access to salesforce to someone on the 3rd part without giving actual salesforce credentials\u003c/strong\u003e. You can call it anonymous access. My case was a scenario when I developed a sophisticated integration with external system (\u003ca href=\"https://en.wikipedia.org/wiki/1C_Company\"\u003e1C:Enterprise platform\u003c/a\u003e) which must be run by a scheduler. But for \u003cstrong\u003etesting purposes\u003c/strong\u003e I had to give the ability to fire callout from Salesforce to 1C for an external developer who made a stuff on 1C part. Usually you perform such testing by yourself as it’s your part of integration. But he need to run this invocation too in order to profile his code. It looks that I can do it for him by request but he need to do that as many times as he want and when he want. Also final testing between all systems should be done on Salesforce production data with UAT 1C environment which will be converted to production version right after successful testing.\u003c/p\u003e\n\u003cp\u003eWhen I was thinking about possible solution I discovered a several ways to do this:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eCreate a temporary user in Salesforce for the external developer and allow him to run apex command via developer console\u003c/li\u003e\n\u003cli\u003eExpose VF/Lightning page with button to invoke apex code via community/site\u003c/li\u003e\n\u003cli\u003eExpose REST service via community/site\u003c/li\u003e\n\u003cli\u003eCreate a proxy service which can be invoked from external and run inside this service a code with my personal credentials\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eSolution with user creation was too bad in security. I prefer to not give credentials to someone external if it’s not required for a business task.\u003c/p\u003e\n\u003cp\u003eDedicated page required controller code, page and community/site + guest user profile configuration to expose it.\u003c/p\u003e\n\u003cp\u003eREST service exposed via site/community also requires community/site + guest user profile configuration.\u003c/p\u003e\n\u003cp\u003eSo the last one seems most simple to me in terms of moving parts which has to be created.\u003c/p\u003e\n\u003cp\u003eThe final solution looks like that\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/p1065/p3.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eProduction integration still aimed to be working by scheduler and the testing application requires 2 parts:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSalesforce REST endpoint\u003c/li\u003e\n\u003cli\u003eGoogle Cloud function\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eApex RESTS endpoint\u003c/strong\u003e is very simple\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token annotation punctuation\"\u003e@RestResource\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eurlMapping\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'/testing-service'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    global \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eTest1CIntegration\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// you know what to do with params\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// generate params list, dynamics queries, proxy param\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// to the external system as request header / param / body\u003c/span\u003e\n        \u003cspan class=\"token class-name\"\u003eMap\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eObject\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e requestJSON\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"token annotation punctuation\"\u003e@HttpGet\u003c/span\u003e\n        global \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e \u003cspan class=\"token function\"\u003egetInvoicesInJSON\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token function\"\u003ehandleRequestParams\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"token comment\"\u003e// do someting with requestJSON\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e JSON\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eserialize\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n                \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003equery\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n                \u003cspan class=\"token class-name\"\u003eWHERE\u003c/span\u003e someField1 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e param1\n                \u003cspan class=\"token class-name\"\u003eAND\u003c/span\u003e someField2 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e param2\n                AND \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eetc\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"token annotation punctuation\"\u003e@HttpPost\u003c/span\u003e\n        global \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eSomeCoolWrapperClassObject\u003c/span\u003e \u003cspan class=\"token function\"\u003esendInvoicesTo1C\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token function\"\u003ehandleRequestParams\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"token comment\"\u003e// do someting with requestJSON\u003c/span\u003e\n            \u003cspan class=\"token comment\"\u003e// actually send data and return 1C response\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003esendInvoicesTo1C\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token function\"\u003ehandleRequestParams\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            requestJSON \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eMap\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eObject\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e JSON\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003edeserializeUntyped\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eRestContext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erequestBody\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003etoString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e key \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e requestJSON\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ekeySet\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"token comment\"\u003e// generate params as you want\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cstrong\u003eThe next part is Google Cloud Function\u003c/strong\u003e. Instead of it you can use Amazon Lambda or any other similar product. I opted for Google Cloud just in order to practice with it.\u003c/p\u003e\n\u003cp\u003eSo, let’s do it. First you need a \u003ca href=\"https://cloud.google.com/\"\u003eGoogle Cloud Platform\u003c/a\u003e account. You will easily setup it by yourself. After setup just find out \u003cstrong\u003eCloud Functions\u003c/strong\u003e in menu and go to it\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/p1065/i4.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eUse \u003cstrong\u003eHTTP trigger\u003c/strong\u003e, it gives you an url which 3rd party person can use to invoke your code with \u003cstrong\u003ecurl\u003c/strong\u003e or \u003cstrong\u003ePostman\u003c/strong\u003e or any other client tool for making requests (even web browser)\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/p1065/image-831x1024.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eThen add required libraries via requirements.txt\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/p1065/image-1.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eI use \u003cstrong\u003e\u003ca href=\"https://github.com/psf/requests\"\u003erequests\u003c/a\u003e\u003c/strong\u003e for performing actual requests to Salesforce\nand \u003ccode\u003esimple-salesforce\u003c/code\u003e in order to login and get session id. Actually you can do all the stuff with \u003ca href=\"https://github.com/simple-salesforce/simple-salesforce\"\u003esimple-salesforce \u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eadd code to \u003cstrong\u003emain.py\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token comment\"\u003e# main.py\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e simple_salesforce \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e Salesforce\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e requests\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e datetime\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e json\n\n\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003emain\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003einitial_request\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    sf_url \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'https://myorg.my.salesforce.com/services/apexrest/testing-service'\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e# request made by 3rd party user\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e# you can put configuration parameters in here\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e# and pass the to Salesforce\u003c/span\u003e\n    request_json \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e initial_request\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eget_json\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    headers \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e sf_login\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    http_method \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'GET'\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e request_json \u003cspan class=\"token keyword\"\u003eis\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enot\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eNone\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        http_method \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'POST'\u003c/span\u003e\n    sf_response \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e requests\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erequest\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n        http_method\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e url\u003cspan class=\"token operator\"\u003e=\u003c/span\u003esf_url\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e json\u003cspan class=\"token operator\"\u003e=\u003c/span\u003erequest_json\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e headers\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eheaders\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e# return SF response to a client\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Test sync run at \"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e datetime\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edatetime\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eutcnow\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estrftime\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'%Y-%m-%d %H:%M:%S'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token string\"\u003e\" (UTC)\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\\n Salesforce Response: \"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e sf_response\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejson\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003esf_login\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e# login to Salesforce\u003c/span\u003e\n    salesforce \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Salesforce\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eusername\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'username'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                            password\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'pass'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                            security_token\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'token'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                            instance\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'https://myorg.my.salesforce.com'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                            sandbox\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token boolean\"\u003eFalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                            version\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'47.0'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e# get session id and return it as auth header\u003c/span\u003e\n    session_id \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e salesforce\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esession_id\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esplit\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"!\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Authorization\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Bearer \"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e session_id\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eclick create and that’s it. You cloud function ready to run. You’re so serverless!\u003c/p\u003e\n\u003cp\u003eNow external developer can use terminal with curl or Postman to perform request to your cloud function which fire SF integration\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ecurl -X POST \"https://us-central1-sftest-999.cloudfunctions.net/integration-1C-test\"     -H \"Content-Type:application/json\"     --data '{\"docType\":\"Invoice\", \"invoiceNumber\": \"i-9999\"}'\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eYou can also easily modify this code in order to run some anonymous form collection. You just need a form which will be hosted somewhere and use this proxy to post data to Salesforce.\u003c/p\u003e\n","title":"Google Cloud Functions for external testing of salesforce API endpoints","date":"2019-12-27T11:30:35+00:00","status":"publish","permalink":"/?p=1065","author":"pavel","excerpt":"","type":"post","category":["integration","web-services"],"tag":["apex","google cloud functions","google cloud platform","integration","serverless"],"post_format":[]}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"p1065"},"buildId":"1lJhNIw9dUYI5aE5LQ2Ro","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-fa276ba060a4a8ac7eef.js"></script><script src="/_next/static/chunks/main-a7c970f167496c3f3d8f.js" async=""></script><script src="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/_next/static/chunks/framework.ef157c678a62cfb2c073.js" async=""></script><script src="/_next/static/chunks/commons.0cd3f0b406132b99fef1.js" async=""></script><script src="/_next/static/chunks/pages/_app-239e31d52738f7fd2278.js" async=""></script><script src="/_next/static/chunks/1d62a1056678c2f23610de94ff6f49e06a569636.2116ac35632db79554b8.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-f26bd131465ef7dfa7da.js" async=""></script><script src="/_next/static/1lJhNIw9dUYI5aE5LQ2Ro/_buildManifest.js" async=""></script><script src="/_next/static/1lJhNIw9dUYI5aE5LQ2Ro/_ssgManifest.js" async=""></script></body></html>