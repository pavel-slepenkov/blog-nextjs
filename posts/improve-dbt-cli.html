<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><link href="https://unpkg.com/prismjs@1.23.0/themes/prism-okaidia.css" rel="stylesheet"/><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="description" content="Pavel Slepenkov&#x27;s personal blog: stories about BI, python, salesforce and data analysis"/><meta http-equiv="cache-control" content="Private"/><meta http-equiv="Expires" content="366000"/><meta property="og:locale" content="en_US"/><meta name="og:title" content="Pavel Slepenkov&#x27;s personal blog"/><meta property="og:description" content="stories about BI, python, salesforce and data analysis"/><meta property="og:type" content="article"/><meta property="og:site_name" content="pavelslepenkov.info"/><meta property="og:image" content="/og.png"/><meta name="twitter:title" content="Pavel Slepenkov&#x27;s personal blog"/><meta name="twitter:description" content="stories about BI, python, salesforce and data analysis"/><meta name="twitter:card" content="summary_large_image"/><meta property="twitter:image" content="/og.png"/><meta name="keywords" content="python, BI, sql, salesforce, data engineering, apex, soql, data analisys"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-63037633-1"></script><script>
                            window.dataLayer = window.dataLayer || [];
                            function gtag(){dataLayer.push(arguments);}
                            gtag('js', new Date());
                            gtag('config', 'UA-63037633-1');
                    </script><style>@import url(&#x27;https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300&amp;family=Spectral:wght@300;600&amp;display=swap&#x27;);</style><title>Improve DBT CLI experience</title><meta name="next-head-count" content="23"/><link rel="preload" href="/_next/static/css/8ed85b7126e02c37.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8ed85b7126e02c37.css" data-n-g=""/><link rel="preload" href="/_next/static/css/992deef8d09b5c87.css" as="style"/><link rel="stylesheet" href="/_next/static/css/992deef8d09b5c87.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-ad45764ecfcae9e5.js" defer=""></script><script src="/_next/static/chunks/main-ee0cf4b7f81d7c24.js" defer=""></script><script src="/_next/static/chunks/pages/_app-2398585b21d2d8c8.js" defer=""></script><script src="/_next/static/chunks/105-51803cf0fd5a7825.js" defer=""></script><script src="/_next/static/chunks/358-14c60bb94e9d94b9.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-c9b3c3f336e43dc2.js" defer=""></script><script src="/_next/static/L-e08mh9kUCbhVYvEMlyR/_buildManifest.js" defer=""></script><script src="/_next/static/L-e08mh9kUCbhVYvEMlyR/_ssgManifest.js" defer=""></script></head><body class="centered"><script src="noflash.js"></script><script src="PathSolver.js"></script><div id="__next"><div class="layout_container__fbLkO"><div class="no-print"><header class="layout_header__kY0Lt"><div class="navbar-link centered"><a class="layout_devNull__CjwH1" href="/">Technical notes</a>—————<a class="layout_devNull__CjwH1" href="/cv">CV</a>—————<a class="layout_devNull__CjwH1" href="/books">Books &amp; Readings</a></div><div class="DarkModeToggle_darkModeToggle__m5z3H"><button type="button">🌞</button><button type="button">🌚</button></div></header></div><main><article><h1 class="utils_headingXl__u25Y2">Improve DBT CLI experience</h1><div class="utils_lightText__eUzGY"><time dateTime="2023-05-05T13:25:00+00:00">May 5, 2023</time></div><div><p>I use <strong>dbt</strong> pretty extensivly on day to day work and switching profiles is a bit tedious. My project uses data vault pattern on top of differnt databases for development, testing and production, so there's a lot of databases, schemas, roles to use.</p>
<p>When I need to implement some feature, I usually start work on <code>DEV</code> environment, where I perform data modeling, initial development and testing. During this work my dbt project should be always be pointing to <code>DEV</code>, as nobody wants to deploy any not complete and not tested changes to the production. When an active development is completed we need to conduct UAT with business stakeholders, during this period I usually need my <strong>dbt</strong> connected to <code>TEST</code> environment. Once everything is compelete, I need to deploy tested feature to the production. It's rarely the case when I can afford to work on a single feature at a time, most probably I'm switching between different features/bugs regularly, so I need prod, then dev, again prod and then test, prod again and dev... Moreover I got few other data sources in dbt.</p>
<p>How does all the configs connected in dbt? Your project's root contains <code>dbt_project.yml</code> file which states a profile name to use via variable <code>profile</code></p>
<div class="remark-highlight"><pre class="language-yml"><code class="language-yml"><span class="token comment"># dbt_project.yml</span>
<span class="token key atrule">profile</span><span class="token punctuation">:</span> <span class="token string">'DBT_SNOWFLAKE'</span>
</code></pre></div>
<p>when <code>~/.dbt/profiles.yml</code> contains actual connection properties</p>
<div class="remark-highlight"><pre class="language-yml"><code class="language-yml"><span class="token key atrule">DBT_SNOWFLAKE</span><span class="token punctuation">:</span>
  <span class="token key atrule">outputs</span><span class="token punctuation">:</span>
    <span class="token key atrule">dev</span><span class="token punctuation">:</span>
      <span class="token key atrule">account</span><span class="token punctuation">:</span> xxx00011
      <span class="token key atrule">client_session_keep_alive</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">database</span><span class="token punctuation">:</span> DEV_DB
      <span class="token key atrule">password</span><span class="token punctuation">:</span> strong_password
      <span class="token key atrule">retry_on_database_errors</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">role</span><span class="token punctuation">:</span> APPACCESS_SNOWFLAKE_DEVELOPER
      <span class="token key atrule">schema</span><span class="token punctuation">:</span> PRD_SCHEMA
      <span class="token key atrule">threads</span><span class="token punctuation">:</span> <span class="token number">8</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> snowflake
      <span class="token key atrule">user</span><span class="token punctuation">:</span> DEV_ETL_USER
      <span class="token key atrule">warehouse</span><span class="token punctuation">:</span> NON_PRD_WAREHOUSE
    <span class="token key atrule">tst</span><span class="token punctuation">:</span>
      <span class="token key atrule">account</span><span class="token punctuation">:</span> xxx00011
      <span class="token key atrule">client_session_keep_alive</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">database</span><span class="token punctuation">:</span> TST_DB
      <span class="token key atrule">password</span><span class="token punctuation">:</span> strong_password
      <span class="token key atrule">retry_on_database_errors</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">role</span><span class="token punctuation">:</span> TST_ETL
      <span class="token key atrule">schema</span><span class="token punctuation">:</span> PRD_SCHEMA
      <span class="token key atrule">threads</span><span class="token punctuation">:</span> <span class="token number">8</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> snowflake
      <span class="token key atrule">user</span><span class="token punctuation">:</span> TST_ETL_USER
      <span class="token key atrule">warehouse</span><span class="token punctuation">:</span> NON_PRD_WAREHOUSE
    <span class="token key atrule">prod</span><span class="token punctuation">:</span>
      <span class="token key atrule">account</span><span class="token punctuation">:</span> xxx00011
      <span class="token key atrule">client_session_keep_alive</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">database</span><span class="token punctuation">:</span> PRD_DB
      <span class="token key atrule">password</span><span class="token punctuation">:</span> strong_password
      <span class="token key atrule">retry_on_database_errors</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">role</span><span class="token punctuation">:</span> PRD_ETL
      <span class="token key atrule">schema</span><span class="token punctuation">:</span> PRD_SCHEMA
      <span class="token key atrule">threads</span><span class="token punctuation">:</span> <span class="token number">8</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> snowflake
      <span class="token key atrule">user</span><span class="token punctuation">:</span> PRD_ETL_USER
      <span class="token key atrule">warehouse</span><span class="token punctuation">:</span> PRD_WAREHOUSE
  <span class="token key atrule">target</span><span class="token punctuation">:</span> prod
</code></pre></div>
<p>where <code>target</code> variable decides which connection should be used.</p>
<p>Your workflow looks like this:</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash"><span class="token comment"># run model on DEV for current dev changes</span>
dbt run <span class="token parameter variable">--models</span> tag:SEMANTIC
<span class="token comment"># open ~/.dbt/profiles.yml file, change target from dev to prod</span>
<span class="token comment"># and run production change, run some dbt stuff</span>
dbt run-operation BuildAllObjects
dbt <span class="token builtin class-name">test</span> <span class="token parameter variable">--select</span> tag:data_freshness_tests
<span class="token comment"># edit ~/.dbt/profiles.yml once again to change target bach from prod to tst</span>
dbt run <span class="token parameter variable">--models</span> tag:SP
<span class="token comment"># edit ~/.dbt/profiles.yml once again to change target bach from tst to dev</span>
<span class="token comment"># continue to work on you dev changes</span>
dbt run <span class="token parameter variable">--models</span> tag:SEMANTIC
</code></pre></div>
<p>Other option is to have different profiles and change <code>dbt_project.yml</code> file. Anyway it requires constant file edits. I really don't like such a hustle. So I read dbt help what wasn't very helpful though. Except one thing, I found <code>--profiles-dir</code> option</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash">dbt <span class="token parameter variable">--help</span>

usage: dbt <span class="token punctuation">[</span>-h<span class="token punctuation">]</span> <span class="token punctuation">[</span>--version<span class="token punctuation">]</span> <span class="token punctuation">[</span>-r RECORD_TIMING_INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>-d<span class="token punctuation">]</span>

<span class="token punctuation">..</span>.

--profiles-dir PROFILES_DIR
                      Which directory to <span class="token function">look</span> <span class="token keyword">in</span> <span class="token keyword">for</span> the profiles.yml file.
                      If not set, dbt will <span class="token function">look</span> <span class="token keyword">in</span> the current working
                      directory first, <span class="token keyword">then</span> <span class="token environment constant">HOME</span>/.dbt/

</code></pre></div>
<p>So, it allows us to tell dbt which profile directory to use. What give me an idea to create a dedicated profile directory for each connection and use aliases</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash">└─$ tree ~/.dbt
<span class="token comment"># in fact I have much more folders and aliases</span>
/Users/admin/.dbt
├── dev
│   └── profiles.yml
├── prod
│   └── profiles.yml
├── prod_sysadmin
│   └── profiles.yml
├── profiles.yml
├── tst
│   └── profiles.yml
└── tst_sysadmin
    └── profiles.yml

<span class="token number">6</span> directories, <span class="token number">8</span> files
</code></pre></div>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash"><span class="token comment"># ~/Users/admin/.aliases</span>
<span class="token assign-left variable">dbt_dev</span><span class="token operator">=</span><span class="token string">'dbt --profiles-dir=/Users/admin/.dbt/dev -x'</span>
<span class="token assign-left variable">dbt_tst</span><span class="token operator">=</span><span class="token string">'dbt --profiles-dir=/Users/admin/.dbt/tst -x'</span>
<span class="token assign-left variable">dbt_prod</span><span class="token operator">=</span><span class="token string">'dbt --profiles-dir=/Users/admin/.dbt/prod -x'</span>
<span class="token assign-left variable">dbt_prod_sysadmin</span><span class="token operator">=</span><span class="token string">'dbt --profiles-dir=/Users/admin/.dbt/prod_sysadmin -x'</span>
<span class="token assign-left variable">dbt_tst_sysadmin</span><span class="token operator">=</span><span class="token string">'dbt --profiles-dir=/Users/admin/.dbt/tst_sysadmin -x'</span>
</code></pre></div>
<p>So now you can use aliases</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash"><span class="token comment"># I don't need to edit any single file now, just use command</span>
<span class="token comment"># moreover it prevents from running incorrect connection when you edited file but forgot to save it</span>
dbt_dev run <span class="token parameter variable">--models</span> tag:SEMANTIC
dbt_prod run-operation BuildAllObjects
dbt_prod <span class="token builtin class-name">test</span> <span class="token parameter variable">--select</span> tag:data_freshness_tests
dbt_tst run <span class="token parameter variable">--models</span> tag:SP
dbt_dev run <span class="token parameter variable">--models</span> tag:SEMANTIC
</code></pre></div>
<p>This approach makes life a little easy. I still have dbt connected to DEV as it's most used and most safe environment to work with, though most of the time I use aliases as it's more explicit.</p>
</div></article><div><span class="utils_tag__r8GDN"><a href="/tag/dbt">[<!-- -->dbt<!-- -->]</a></span><span class="utils_tag__r8GDN"><a href="/tag/cli">[<!-- -->cli<!-- -->]</a></span></div></main><div class="layout_backToHome__9sjx_"><a href="/">⇐ back to home</a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"improve-dbt-cli","contentHtml":"\u003cp\u003eI use \u003cstrong\u003edbt\u003c/strong\u003e pretty extensivly on day to day work and switching profiles is a bit tedious. My project uses data vault pattern on top of differnt databases for development, testing and production, so there's a lot of databases, schemas, roles to use.\u003c/p\u003e\n\u003cp\u003eWhen I need to implement some feature, I usually start work on \u003ccode\u003eDEV\u003c/code\u003e environment, where I perform data modeling, initial development and testing. During this work my dbt project should be always be pointing to \u003ccode\u003eDEV\u003c/code\u003e, as nobody wants to deploy any not complete and not tested changes to the production. When an active development is completed we need to conduct UAT with business stakeholders, during this period I usually need my \u003cstrong\u003edbt\u003c/strong\u003e connected to \u003ccode\u003eTEST\u003c/code\u003e environment. Once everything is compelete, I need to deploy tested feature to the production. It's rarely the case when I can afford to work on a single feature at a time, most probably I'm switching between different features/bugs regularly, so I need prod, then dev, again prod and then test, prod again and dev... Moreover I got few other data sources in dbt.\u003c/p\u003e\n\u003cp\u003eHow does all the configs connected in dbt? Your project's root contains \u003ccode\u003edbt_project.yml\u003c/code\u003e file which states a profile name to use via variable \u003ccode\u003eprofile\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-yml\"\u003e\u003ccode class=\"language-yml\"\u003e\u003cspan class=\"token comment\"\u003e# dbt_project.yml\u003c/span\u003e\n\u003cspan class=\"token key atrule\"\u003eprofile\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'DBT_SNOWFLAKE'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ewhen \u003ccode\u003e~/.dbt/profiles.yml\u003c/code\u003e contains actual connection properties\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-yml\"\u003e\u003ccode class=\"language-yml\"\u003e\u003cspan class=\"token key atrule\"\u003eDBT_SNOWFLAKE\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"token key atrule\"\u003eoutputs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token key atrule\"\u003edev\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"token key atrule\"\u003eaccount\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e xxx00011\n      \u003cspan class=\"token key atrule\"\u003eclient_session_keep_alive\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean important\"\u003efalse\u003c/span\u003e\n      \u003cspan class=\"token key atrule\"\u003edatabase\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e DEV_DB\n      \u003cspan class=\"token key atrule\"\u003epassword\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e strong_password\n      \u003cspan class=\"token key atrule\"\u003eretry_on_database_errors\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean important\"\u003efalse\u003c/span\u003e\n      \u003cspan class=\"token key atrule\"\u003erole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e APPACCESS_SNOWFLAKE_DEVELOPER\n      \u003cspan class=\"token key atrule\"\u003eschema\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e PRD_SCHEMA\n      \u003cspan class=\"token key atrule\"\u003ethreads\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e8\u003c/span\u003e\n      \u003cspan class=\"token key atrule\"\u003etype\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e snowflake\n      \u003cspan class=\"token key atrule\"\u003euser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e DEV_ETL_USER\n      \u003cspan class=\"token key atrule\"\u003ewarehouse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e NON_PRD_WAREHOUSE\n    \u003cspan class=\"token key atrule\"\u003etst\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"token key atrule\"\u003eaccount\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e xxx00011\n      \u003cspan class=\"token key atrule\"\u003eclient_session_keep_alive\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean important\"\u003efalse\u003c/span\u003e\n      \u003cspan class=\"token key atrule\"\u003edatabase\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e TST_DB\n      \u003cspan class=\"token key atrule\"\u003epassword\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e strong_password\n      \u003cspan class=\"token key atrule\"\u003eretry_on_database_errors\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean important\"\u003efalse\u003c/span\u003e\n      \u003cspan class=\"token key atrule\"\u003erole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e TST_ETL\n      \u003cspan class=\"token key atrule\"\u003eschema\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e PRD_SCHEMA\n      \u003cspan class=\"token key atrule\"\u003ethreads\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e8\u003c/span\u003e\n      \u003cspan class=\"token key atrule\"\u003etype\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e snowflake\n      \u003cspan class=\"token key atrule\"\u003euser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e TST_ETL_USER\n      \u003cspan class=\"token key atrule\"\u003ewarehouse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e NON_PRD_WAREHOUSE\n    \u003cspan class=\"token key atrule\"\u003eprod\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"token key atrule\"\u003eaccount\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e xxx00011\n      \u003cspan class=\"token key atrule\"\u003eclient_session_keep_alive\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean important\"\u003efalse\u003c/span\u003e\n      \u003cspan class=\"token key atrule\"\u003edatabase\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e PRD_DB\n      \u003cspan class=\"token key atrule\"\u003epassword\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e strong_password\n      \u003cspan class=\"token key atrule\"\u003eretry_on_database_errors\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean important\"\u003efalse\u003c/span\u003e\n      \u003cspan class=\"token key atrule\"\u003erole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e PRD_ETL\n      \u003cspan class=\"token key atrule\"\u003eschema\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e PRD_SCHEMA\n      \u003cspan class=\"token key atrule\"\u003ethreads\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e8\u003c/span\u003e\n      \u003cspan class=\"token key atrule\"\u003etype\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e snowflake\n      \u003cspan class=\"token key atrule\"\u003euser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e PRD_ETL_USER\n      \u003cspan class=\"token key atrule\"\u003ewarehouse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e PRD_WAREHOUSE\n  \u003cspan class=\"token key atrule\"\u003etarget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e prod\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ewhere \u003ccode\u003etarget\u003c/code\u003e variable decides which connection should be used.\u003c/p\u003e\n\u003cp\u003eYour workflow looks like this:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e\u003cspan class=\"token comment\"\u003e# run model on DEV for current dev changes\u003c/span\u003e\ndbt run \u003cspan class=\"token parameter variable\"\u003e--models\u003c/span\u003e tag:SEMANTIC\n\u003cspan class=\"token comment\"\u003e# open ~/.dbt/profiles.yml file, change target from dev to prod\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# and run production change, run some dbt stuff\u003c/span\u003e\ndbt run-operation BuildAllObjects\ndbt \u003cspan class=\"token builtin class-name\"\u003etest\u003c/span\u003e \u003cspan class=\"token parameter variable\"\u003e--select\u003c/span\u003e tag:data_freshness_tests\n\u003cspan class=\"token comment\"\u003e# edit ~/.dbt/profiles.yml once again to change target bach from prod to tst\u003c/span\u003e\ndbt run \u003cspan class=\"token parameter variable\"\u003e--models\u003c/span\u003e tag:SP\n\u003cspan class=\"token comment\"\u003e# edit ~/.dbt/profiles.yml once again to change target bach from tst to dev\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# continue to work on you dev changes\u003c/span\u003e\ndbt run \u003cspan class=\"token parameter variable\"\u003e--models\u003c/span\u003e tag:SEMANTIC\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOther option is to have different profiles and change \u003ccode\u003edbt_project.yml\u003c/code\u003e file. Anyway it requires constant file edits. I really don't like such a hustle. So I read dbt help what wasn't very helpful though. Except one thing, I found \u003ccode\u003e--profiles-dir\u003c/code\u003e option\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003edbt \u003cspan class=\"token parameter variable\"\u003e--help\u003c/span\u003e\n\nusage: dbt \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e-h\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e--version\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e-r RECORD_TIMING_INFO\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e-d\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\n\u003cspan class=\"token punctuation\"\u003e..\u003c/span\u003e.\n\n--profiles-dir PROFILES_DIR\n                      Which directory to \u003cspan class=\"token function\"\u003elook\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e the profiles.yml file.\n                      If not set, dbt will \u003cspan class=\"token function\"\u003elook\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e the current working\n                      directory first, \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e \u003cspan class=\"token environment constant\"\u003eHOME\u003c/span\u003e/.dbt/\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eSo, it allows us to tell dbt which profile directory to use. What give me an idea to create a dedicated profile directory for each connection and use aliases\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e└─$ tree ~/.dbt\n\u003cspan class=\"token comment\"\u003e# in fact I have much more folders and aliases\u003c/span\u003e\n/Users/admin/.dbt\n├── dev\n│   └── profiles.yml\n├── prod\n│   └── profiles.yml\n├── prod_sysadmin\n│   └── profiles.yml\n├── profiles.yml\n├── tst\n│   └── profiles.yml\n└── tst_sysadmin\n    └── profiles.yml\n\n\u003cspan class=\"token number\"\u003e6\u003c/span\u003e directories, \u003cspan class=\"token number\"\u003e8\u003c/span\u003e files\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e\u003cspan class=\"token comment\"\u003e# ~/Users/admin/.aliases\u003c/span\u003e\n\u003cspan class=\"token assign-left variable\"\u003edbt_dev\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'dbt --profiles-dir=/Users/admin/.dbt/dev -x'\u003c/span\u003e\n\u003cspan class=\"token assign-left variable\"\u003edbt_tst\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'dbt --profiles-dir=/Users/admin/.dbt/tst -x'\u003c/span\u003e\n\u003cspan class=\"token assign-left variable\"\u003edbt_prod\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'dbt --profiles-dir=/Users/admin/.dbt/prod -x'\u003c/span\u003e\n\u003cspan class=\"token assign-left variable\"\u003edbt_prod_sysadmin\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'dbt --profiles-dir=/Users/admin/.dbt/prod_sysadmin -x'\u003c/span\u003e\n\u003cspan class=\"token assign-left variable\"\u003edbt_tst_sysadmin\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'dbt --profiles-dir=/Users/admin/.dbt/tst_sysadmin -x'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eSo now you can use aliases\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e\u003cspan class=\"token comment\"\u003e# I don't need to edit any single file now, just use command\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# moreover it prevents from running incorrect connection when you edited file but forgot to save it\u003c/span\u003e\ndbt_dev run \u003cspan class=\"token parameter variable\"\u003e--models\u003c/span\u003e tag:SEMANTIC\ndbt_prod run-operation BuildAllObjects\ndbt_prod \u003cspan class=\"token builtin class-name\"\u003etest\u003c/span\u003e \u003cspan class=\"token parameter variable\"\u003e--select\u003c/span\u003e tag:data_freshness_tests\ndbt_tst run \u003cspan class=\"token parameter variable\"\u003e--models\u003c/span\u003e tag:SP\ndbt_dev run \u003cspan class=\"token parameter variable\"\u003e--models\u003c/span\u003e tag:SEMANTIC\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis approach makes life a little easy. I still have dbt connected to DEV as it's most used and most safe environment to work with, though most of the time I use aliases as it's more explicit.\u003c/p\u003e\n","title":"Improve DBT CLI experience","date":"2023-05-05T13:25:00+00:00","status":"publish","author":"pavel","type":"post","tag":["dbt","cli"]}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"improve-dbt-cli"},"buildId":"L-e08mh9kUCbhVYvEMlyR","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>