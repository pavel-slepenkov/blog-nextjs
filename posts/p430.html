<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><link href="https://unpkg.com/prismjs@1.23.0/themes/prism-okaidia.css" rel="stylesheet"/><meta name="description" content="Pavel Slepenkov - developer"/><meta property="og:image" content="/og.png"/><meta http-equiv="cache-control" content="Private"/><meta http-equiv="Expires" content="366000"/><meta name="og:title" content="Pavel Slepenkov&#x27;s personal blog"/><meta property="og:type" content="article"/><meta property="og:site_name" content="pavelslepenkov.info"/><meta name="twitter:card" content="summary_large_image"/><meta name="yandex-verification" content="35a3887ea995a4c4"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-63037633-1"></script><script>
                            window.dataLayer = window.dataLayer || [];
                            function gtag(){dataLayer.push(arguments);}
                            gtag('js', new Date());
                            gtag('config', 'UA-63037633-1');
                    </script><style>@import url(&#x27;https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300&amp;family=Spectral:wght@300&amp;display=swap&#x27;);</style><title>How to spend 6 hours to debug one dummy profile configuration error or INSUFFICIENT_ACCESS_ON_CROSS_REFERENCE_ENTITY, insufficient access rights on cross-reference id: []</title><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/9c9a143fd1d8598053fb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9c9a143fd1d8598053fb.css" data-n-g=""/><link rel="preload" href="/_next/static/css/6dce80f39b6e217927f5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6dce80f39b6e217927f5.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-a7c970f167496c3f3d8f.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.ef157c678a62cfb2c073.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.0cd3f0b406132b99fef1.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-12284d2b694fe68be2f6.js" as="script"/><link rel="preload" href="/_next/static/chunks/e13a01db57b31397727b4fe1a84334603f8304a9.b77aa9047944bdddc5c6.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bid%5D-1e8c411735e88fd08d05.js" as="script"/></head><body><script src="noflash.js"></script><script src="PathSolver.js"></script><div id="__next"><div class="layout_container__2t4v2"><header class="layout_header__2rhWq"><div class="navbar-link"><a class="layout_devNull__6Fs9d" href="/">$ /dev/null</a>———<a styleClass="layout_devNull__6Fs9d" href="https://pavel-slepenkov.github.io">About </a>———<a styleClass="layout_devNull__6Fs9d" href="https://pavel-slepenkov.github.io">Projects</a></div><div class="DarkModeToggle_darkModeToggle__2u4u3"><button type="button">☀</button><toggle></toggle><button type="button">☾</button></div></header><main><article><h1 class="utils_headingXl__1XecN">How to spend 6 hours to debug one dummy profile configuration error or INSUFFICIENT_ACCESS_ON_CROSS_REFERENCE_ENTITY, insufficient access rights on cross-reference id: []</h1><div class="utils_lightText__12Ckm"><time dateTime="2015-05-15T16:08:33+01:00">May 15, 2015</time></div><div><p>After first public release of my past project we have faced a trouble with existing users who use a few existing applications in a client production org. For this project we had no people resources for a good integration testing thus such bugs were not surprise for us. Usually it’s a headache when you develop a project and have to integrate it inside Salesforce org which is used for a few years. In may times you will find a set of unmanaged packages from AppExchange, some customization and some apex code which has been developed by independent teams or might be freelancer. As a result pretty often you can find a many profiles and permission sets which has been poorly configured.</p>
<p>That was my case. I’ve been notified that user with profile from legacy application has started to get the following error during adding an Idea:</p>
<blockquote>
<p>INSUFFICIENT_ACCESS_ON_CROSS_REFERENCE_ENTITY, insufficient access rights on cross-reference id: []</p>
</blockquote>
<p>Such error points to profile configuration troubles. In most case such troubles can be fixed in minutes. But anyway first of all we have to reproduce this error on test environment before fixing.</p>
<p>I logged in under this user and tried to reproduce the error. Sure, I got it. The error has came from Idea.trigger which was not in scope of project which I has developed. It might mislead greenhorn developers. So, the situation was the following: users with profile which has not been changed by me got error during his usual work with application which has not been developed or changed by me.
Interesting.</p>
<p>Pretty fast I found that Idea.trigger from legacy application creates a new Case for every new Idea. So, my application has trigger on Case and it was the reason. I pretty quick find a place from which the error came. That was an apex method like the following:</p>
<p>[java]
public static Boolean isCommunityUser() {
return Constants.PROFILE_NAME_COMMUNITY_USER.equalsIgnoreCase([SELECT Name FROM Profile WHERE Id =: UserInfo.getProfileId()].Name);
}
[/java]</p>
<p>As you can see this method just querying current user profile and trying to match it with name of Community user profile. Fairly simple code in just one line and the error is here. So, I checked the profile access for sObjects which were under any DML operations, apex classes which were used by Case.trigger. The profile was OK. My mind has been freeze after this point.</p>
<p>Finally I tried to reproduce the trouble again and go through full execution stack. At this moment I found that Constants class has several variables like that:</p>
<p>[java]
public static final Set&#x3C;Type> SOBJECTS_WITH_SHARING = new Set&#x3C;Type>{Question.class, Idea.class, DocumentWrapper__c.class, Topic__kav.class};
[/java]</p>
<p>I didn’t use this code directly in Case trigger, but this string is initialized during class initialization in static context. And ultimately that was the root of the bug. Here we have several accessing of Type class variables. And for two of them the profile has no rights. Profile has no any rights for DocumentWrapper__c custom object and for Topic__kav article type. I know that for custom object that should not be a trouble, but what about article type? I gave read right for Topic__kav article type and the error was fixed.</p>
<p>This bug remind a few very important things about Salesforce:</p>
<ol>
<li>You has many ways to break legacy applications in Salesforce and triggers are most simple way.</li>
<li>Perform integration testing and try to start such testing in the first iteration of your development.</li>
<li>Your application might be broken by new application which will be installed to org in future, thus you have to separate and isolate your application out of other as much as you can.</li>
<li>Salesforce is pretty hard development environment with huge amount of pitfalls</li>
</ol>
</div></article><div></div></main><div class="layout_backToHome__1vZsp"><a href="/">⇐ back to home</a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"p430","contentHtml":"\u003cp\u003eAfter first public release of my past project we have faced a trouble with existing users who use a few existing applications in a client production org. For this project we had no people resources for a good integration testing thus such bugs were not surprise for us. Usually it’s a headache when you develop a project and have to integrate it inside Salesforce org which is used for a few years. In may times you will find a set of unmanaged packages from AppExchange, some customization and some apex code which has been developed by independent teams or might be freelancer. As a result pretty often you can find a many profiles and permission sets which has been poorly configured.\u003c/p\u003e\n\u003cp\u003eThat was my case. I’ve been notified that user with profile from legacy application has started to get the following error during adding an Idea:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eINSUFFICIENT_ACCESS_ON_CROSS_REFERENCE_ENTITY, insufficient access rights on cross-reference id: []\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eSuch error points to profile configuration troubles. In most case such troubles can be fixed in minutes. But anyway first of all we have to reproduce this error on test environment before fixing.\u003c/p\u003e\n\u003cp\u003eI logged in under this user and tried to reproduce the error. Sure, I got it. The error has came from Idea.trigger which was not in scope of project which I has developed. It might mislead greenhorn developers. So, the situation was the following: users with profile which has not been changed by me got error during his usual work with application which has not been developed or changed by me.\nInteresting.\u003c/p\u003e\n\u003cp\u003ePretty fast I found that Idea.trigger from legacy application creates a new Case for every new Idea. So, my application has trigger on Case and it was the reason. I pretty quick find a place from which the error came. That was an apex method like the following:\u003c/p\u003e\n\u003cp\u003e[java]\npublic static Boolean isCommunityUser() {\nreturn Constants.PROFILE_NAME_COMMUNITY_USER.equalsIgnoreCase([SELECT Name FROM Profile WHERE Id =: UserInfo.getProfileId()].Name);\n}\n[/java]\u003c/p\u003e\n\u003cp\u003eAs you can see this method just querying current user profile and trying to match it with name of Community user profile. Fairly simple code in just one line and the error is here. So, I checked the profile access for sObjects which were under any DML operations, apex classes which were used by Case.trigger. The profile was OK. My mind has been freeze after this point.\u003c/p\u003e\n\u003cp\u003eFinally I tried to reproduce the trouble again and go through full execution stack. At this moment I found that Constants class has several variables like that:\u003c/p\u003e\n\u003cp\u003e[java]\npublic static final Set\u0026#x3C;Type\u003e SOBJECTS_WITH_SHARING = new Set\u0026#x3C;Type\u003e{Question.class, Idea.class, DocumentWrapper__c.class, Topic__kav.class};\n[/java]\u003c/p\u003e\n\u003cp\u003eI didn’t use this code directly in Case trigger, but this string is initialized during class initialization in static context. And ultimately that was the root of the bug. Here we have several accessing of Type class variables. And for two of them the profile has no rights. Profile has no any rights for DocumentWrapper__c custom object and for Topic__kav article type. I know that for custom object that should not be a trouble, but what about article type? I gave read right for Topic__kav article type and the error was fixed.\u003c/p\u003e\n\u003cp\u003eThis bug remind a few very important things about Salesforce:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eYou has many ways to break legacy applications in Salesforce and triggers are most simple way.\u003c/li\u003e\n\u003cli\u003ePerform integration testing and try to start such testing in the first iteration of your development.\u003c/li\u003e\n\u003cli\u003eYour application might be broken by new application which will be installed to org in future, thus you have to separate and isolate your application out of other as much as you can.\u003c/li\u003e\n\u003cli\u003eSalesforce is pretty hard development environment with huge amount of pitfalls\u003c/li\u003e\n\u003c/ol\u003e\n","title":"How to spend 6 hours to debug one dummy profile configuration error or INSUFFICIENT_ACCESS_ON_CROSS_REFERENCE_ENTITY, insufficient access rights on cross-reference id: []","date":"2015-05-15T16:08:33+01:00","status":"publish","permalink":"/?p=430","author":"pavel","excerpt":"","type":"post","category":["apex","Errors","force.com"],"tag":[],"post_format":[],"cleanretina_sidebarlayout":["default"],"dsq_thread_id":["5607847082"]}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"p430"},"buildId":"_UnEgQk5VeY3qAyUffSF2","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-a98cee78eb8282e29fb6.js"></script><script src="/_next/static/chunks/main-a7c970f167496c3f3d8f.js" async=""></script><script src="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/_next/static/chunks/framework.ef157c678a62cfb2c073.js" async=""></script><script src="/_next/static/chunks/commons.0cd3f0b406132b99fef1.js" async=""></script><script src="/_next/static/chunks/pages/_app-12284d2b694fe68be2f6.js" async=""></script><script src="/_next/static/chunks/e13a01db57b31397727b4fe1a84334603f8304a9.b77aa9047944bdddc5c6.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-1e8c411735e88fd08d05.js" async=""></script><script src="/_next/static/_UnEgQk5VeY3qAyUffSF2/_buildManifest.js" async=""></script><script src="/_next/static/_UnEgQk5VeY3qAyUffSF2/_ssgManifest.js" async=""></script></body></html>