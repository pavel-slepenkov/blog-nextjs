<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><link href="https://unpkg.com/prismjs@1.23.0/themes/prism-okaidia.css" rel="stylesheet"/><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="description" content="Pavel Slepenkov&#x27;s personal blog: stories about BI, python, salesforce and data analysis"/><meta http-equiv="cache-control" content="Private"/><meta http-equiv="Expires" content="366000"/><meta property="og:locale" content="en_US"/><meta name="og:title" content="Pavel Slepenkov&#x27;s personal blog"/><meta property="og:description" content="stories about BI, python, salesforce and data analysis"/><meta property="og:type" content="article"/><meta property="og:site_name" content="pavelslepenkov.info"/><meta property="og:image" content="/og.png"/><meta name="twitter:title" content="Pavel Slepenkov&#x27;s personal blog"/><meta name="twitter:description" content="stories about BI, python, salesforce and data analysis"/><meta name="twitter:card" content="summary_large_image"/><meta property="twitter:image" content="/og.png"/><meta name="keywords" content="python, BI, sql, salesforce, data engineering, apex, soql, data analisys"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-63037633-1"></script><script>
                            window.dataLayer = window.dataLayer || [];
                            function gtag(){dataLayer.push(arguments);}
                            gtag('js', new Date());
                            gtag('config', 'UA-63037633-1');
                    </script><style>@import url(&#x27;https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300&amp;family=Spectral:wght@300;600&amp;display=swap&#x27;);</style><title>How to spend 6 hours to debug one dummy profile configuration error or INSUFFICIENT_ACCESS_ON_CROSS_REFERENCE_ENTITY, insufficient access rights on cross-reference id: []</title><meta name="next-head-count" content="23"/><link rel="preload" href="/_next/static/css/36ece68f30a73b79.css" as="style"/><link rel="stylesheet" href="/_next/static/css/36ece68f30a73b79.css" data-n-g=""/><link rel="preload" href="/_next/static/css/38c3b924c786bb52.css" as="style"/><link rel="stylesheet" href="/_next/static/css/38c3b924c786bb52.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-ad45764ecfcae9e5.js" defer=""></script><script src="/_next/static/chunks/main-ee0cf4b7f81d7c24.js" defer=""></script><script src="/_next/static/chunks/pages/_app-2398585b21d2d8c8.js" defer=""></script><script src="/_next/static/chunks/105-51803cf0fd5a7825.js" defer=""></script><script src="/_next/static/chunks/358-14c60bb94e9d94b9.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-8c5a1f5b65ec0a5a.js" defer=""></script><script src="/_next/static/9HxoGffdUL-kOR0x0J2xH/_buildManifest.js" defer=""></script><script src="/_next/static/9HxoGffdUL-kOR0x0J2xH/_ssgManifest.js" defer=""></script></head><body class="centered"><script src="noflash.js"></script><script src="PathSolver.js"></script><div id="__next"><div class="layout_container__fbLkO"><div class="no-print"><header class="layout_header__kY0Lt"><div class="navbar-link"><a class="layout_devNull__CjwH1" href="/">Technical notes</a>‚Äî‚Äî‚Äî‚Äî‚Äî<a class="layout_devNull__CjwH1" href="/cv">CV</a>‚Äî‚Äî‚Äî‚Äî‚Äî<a class="layout_devNull__CjwH1" href="/books">Book reviews</a></div><div class="DarkModeToggle_darkModeToggle__m5z3H"><button type="button">üåû</button><button type="button">üåö</button></div></header></div><main><article><h1 class="utils_headingXl__u25Y2">How to spend 6 hours to debug one dummy profile configuration error or INSUFFICIENT_ACCESS_ON_CROSS_REFERENCE_ENTITY, insufficient access rights on cross-reference id: []</h1><div class="utils_lightText__eUzGY"><time dateTime="2015-05-15T16:08:33+01:00">May 15, 2015</time></div><div><p>After first public release of my past project we have faced a trouble with existing users who use a few existing applications in a client production org. For this project we had no people resources for a good integration testing thus such bugs were not surprise for us. Usually it‚Äôs a headache when you develop a project and have to integrate it inside Salesforce org which is used for a few years. In may times you will find a set of unmanaged packages from AppExchange, some customization and some apex code which has been developed by independent teams or might be freelancer. As a result pretty often you can find a many profiles and permission sets which has been poorly configured.</p>
<p>That was my case. I‚Äôve been notified that user with profile from legacy application has started to get the following error during adding an Idea:</p>
<blockquote>
<p>INSUFFICIENT_ACCESS_ON_CROSS_REFERENCE_ENTITY, insufficient access rights on cross-reference id: []</p>
</blockquote>
<p>Such error points to profile configuration troubles. In most case such troubles can be fixed in minutes. But anyway first of all we have to reproduce this error on test environment before fixing.</p>
<p>I logged in under this user and tried to reproduce the error. Sure, I got it. The error has came from Idea.trigger which was not in scope of project which I has developed. It might mislead greenhorn developers. So, the situation was the following: users with profile which has not been changed by me got error during his usual work with application which has not been developed or changed by me.
Interesting.</p>
<p>Pretty fast I found that Idea.trigger from legacy application creates a new Case for every new Idea. So, my application has trigger on Case and it was the reason. I pretty quick find a place from which the error came. That was an apex method like the following:</p>
<div class="remark-highlight"><pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Boolean</span> <span class="token function">isCommunityUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">PROFILE_NAME_COMMUNITY_USER</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>
        <span class="token punctuation">[</span>
            <span class="token constant">SELECT</span> <span class="token class-name">Name</span>
            <span class="token constant">FROM</span> <span class="token class-name">Profile</span>
            <span class="token constant">WHERE</span> <span class="token class-name">Id</span> <span class="token operator">=</span><span class="token operator">:</span> <span class="token class-name">UserInfo</span><span class="token punctuation">.</span><span class="token function">getProfileId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">.</span>Name
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>As you can see this method just querying current user profile and trying to match it with name of Community user profile. Fairly simple code in just one line and the error is here. So, I checked the profile access for sObjects which were under any DML operations, apex classes which were used by Case.trigger. The profile was OK. My mind has been freeze after this point.</p>
<p>Finally I tried to reproduce the trouble again and go through full execution stack. At this moment I found that Constants class has several variables like that:</p>
<div class="remark-highlight"><pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&#x3C;</span><span class="token class-name">Type</span><span class="token punctuation">></span></span> <span class="token constant">SOBJECTS_WITH_SHARING</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&#x3C;</span><span class="token class-name">Type</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>
        <span class="token class-name">Question</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token class-name">Idea</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token class-name">DocumentWrapper__c</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token class-name">Topic__kav</span><span class="token punctuation">.</span><span class="token keyword">class</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div>
<p>I didn‚Äôt use this code directly in Case trigger, but this string is initialized during class initialization in static context. And ultimately that was the root of the bug. Here we have several accessing of Type class variables. And for two of them the profile has no rights. Profile has no any rights for DocumentWrapper__c custom object and for Topic__kav article type. I know that for custom object that should not be a trouble, but what about article type? I gave read right for Topic__kav article type and the error was fixed.</p>
<p>This bug remind a few very important things about Salesforce:</p>
<ol>
<li>You has many ways to break legacy applications in Salesforce and triggers.</li>
<li>Perform integration testing and try to start this testing in the first iteration of development.</li>
<li>Your application might be broken by new application which will be installed to org in future, thus you have to separate and isolate your application out of other as much as you can.</li>
<li>Salesforce is pretty hard development environment with huge amount of pitfalls</li>
</ol>
</div></article><div><span class="utils_tag__r8GDN"><a href="/tag/apex">[<!-- -->apex<!-- -->]</a></span><span class="utils_tag__r8GDN"><a href="/tag/salesforce">[<!-- -->salesforce<!-- -->]</a></span><span class="utils_tag__r8GDN"><a href="/tag/salesforce-exception">[<!-- -->salesforce exception<!-- -->]</a></span></div></main><div class="layout_backToHome__9sjx_"><a href="/">‚áê back to home</a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"p430","contentHtml":"\u003cp\u003eAfter first public release of my past project we have faced a trouble with existing users who use a few existing applications in a client production org. For this project we had no people resources for a good integration testing thus such bugs were not surprise for us. Usually it‚Äôs a headache when you develop a project and have to integrate it inside Salesforce org which is used for a few years. In may times you will find a set of unmanaged packages from AppExchange, some customization and some apex code which has been developed by independent teams or might be freelancer. As a result pretty often you can find a many profiles and permission sets which has been poorly configured.\u003c/p\u003e\n\u003cp\u003eThat was my case. I‚Äôve been notified that user with profile from legacy application has started to get the following error during adding an Idea:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eINSUFFICIENT_ACCESS_ON_CROSS_REFERENCE_ENTITY, insufficient access rights on cross-reference id: []\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eSuch error points to profile configuration troubles. In most case such troubles can be fixed in minutes. But anyway first of all we have to reproduce this error on test environment before fixing.\u003c/p\u003e\n\u003cp\u003eI logged in under this user and tried to reproduce the error. Sure, I got it. The error has came from Idea.trigger which was not in scope of project which I has developed. It might mislead greenhorn developers. So, the situation was the following: users with profile which has not been changed by me got error during his usual work with application which has not been developed or changed by me.\nInteresting.\u003c/p\u003e\n\u003cp\u003ePretty fast I found that Idea.trigger from legacy application creates a new Case for every new Idea. So, my application has trigger on Case and it was the reason. I pretty quick find a place from which the error came. That was an apex method like the following:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eBoolean\u003c/span\u003e \u003cspan class=\"token function\"\u003eisCommunityUser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eConstants\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003ePROFILE_NAME_COMMUNITY_USER\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eequalsIgnoreCase\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n            \u003cspan class=\"token constant\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eName\u003c/span\u003e\n            \u003cspan class=\"token constant\"\u003eFROM\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eProfile\u003c/span\u003e\n            \u003cspan class=\"token constant\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eId\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eUserInfo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetProfileId\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eName\n    \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAs you can see this method just querying current user profile and trying to match it with name of Community user profile. Fairly simple code in just one line and the error is here. So, I checked the profile access for sObjects which were under any DML operations, apex classes which were used by Case.trigger. The profile was OK. My mind has been freeze after this point.\u003c/p\u003e\n\u003cp\u003eFinally I tried to reproduce the trouble again and go through full execution stack. At this moment I found that Constants class has several variables like that:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003e\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eSet\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token constant\"\u003eSOBJECTS_WITH_SHARING\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eSet\u003c/span\u003e\u003cspan class=\"token generics\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token class-name\"\u003eQuestion\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token class-name\"\u003eIdea\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token class-name\"\u003eDocumentWrapper__c\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token class-name\"\u003eTopic__kav\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eI didn‚Äôt use this code directly in Case trigger, but this string is initialized during class initialization in static context. And ultimately that was the root of the bug. Here we have several accessing of Type class variables. And for two of them the profile has no rights. Profile has no any rights for DocumentWrapper__c custom object and for Topic__kav article type. I know that for custom object that should not be a trouble, but what about article type? I gave read right for Topic__kav article type and the error was fixed.\u003c/p\u003e\n\u003cp\u003eThis bug remind a few very important things about Salesforce:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eYou has many ways to break legacy applications in Salesforce and triggers.\u003c/li\u003e\n\u003cli\u003ePerform integration testing and try to start this testing in the first iteration of development.\u003c/li\u003e\n\u003cli\u003eYour application might be broken by new application which will be installed to org in future, thus you have to separate and isolate your application out of other as much as you can.\u003c/li\u003e\n\u003cli\u003eSalesforce is pretty hard development environment with huge amount of pitfalls\u003c/li\u003e\n\u003c/ol\u003e\n","title":"How to spend 6 hours to debug one dummy profile configuration error or INSUFFICIENT_ACCESS_ON_CROSS_REFERENCE_ENTITY, insufficient access rights on cross-reference id: []","date":"2015-05-15T16:08:33+01:00","status":"publish","permalink":"/?p=430","author":"pavel","excerpt":"","type":"post","category":["apex","Errors","force.com"],"tag":["apex","salesforce","salesforce exception"]}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"p430"},"buildId":"9HxoGffdUL-kOR0x0J2xH","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>