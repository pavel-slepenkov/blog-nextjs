<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><link rel="preload" href="https://unpkg.com/prismjs@0.0.1/themes/prism-tomorrow.css" as="script"/><link rel="preload" href="https://unpkg.com/prismjs@0.0.1/themes/prism-coy.css" as="script"/><link rel="preload" href="https://unpkg.com/prismjs@0.0.1/themes/prism-okaidia.css" as="script"/><link rel="preload" href="https://unpkg.com/prismjs@0.0.1/themes/prism-funky.css" as="script"/><link href="https://unpkg.com/prismjs@0.0.1/themes/prism-okaidia.css" rel="stylesheet"/><meta name="description" content="Pavel Slepenkov - developer"/><meta property="og:image" content="https://og-image.now.sh/Pavel%20Slepenkov%20personal%20blog.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fhyper-color-logo.svg&amp;widths=auto"/><meta name="og:title" content="Pavel Slepenkov personal blog"/><meta name="twitter:card" content="summary_large_image"/><title>Emulation of date and time on Force.com</title><meta name="next-head-count" content="13"/><link rel="preload" href="/blog-nextjs/_next/static/css/d9f62f5770aa60bc54db.css" as="style"/><link rel="stylesheet" href="/blog-nextjs/_next/static/css/d9f62f5770aa60bc54db.css" data-n-g=""/><link rel="preload" href="/blog-nextjs/_next/static/css/7b989d401051c7c1fc1a.css" as="style"/><link rel="stylesheet" href="/blog-nextjs/_next/static/css/7b989d401051c7c1fc1a.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/blog-nextjs/_next/static/chunks/main-a7c970f167496c3f3d8f.js" as="script"/><link rel="preload" href="/blog-nextjs/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/blog-nextjs/_next/static/chunks/framework.2113c6061a2f456066a1.js" as="script"/><link rel="preload" href="/blog-nextjs/_next/static/chunks/commons.390514621f46153c0d8a.js" as="script"/><link rel="preload" href="/blog-nextjs/_next/static/chunks/pages/_app-63f54fbe8fbe4d14dff9.js" as="script"/><link rel="preload" href="/blog-nextjs/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.22009c787aae00c65fc7.js" as="script"/><link rel="preload" href="/blog-nextjs/_next/static/chunks/pages/posts/%5Bid%5D-4c37b983192d656c52ce.js" as="script"/></head><body><div id="__next"><div class="layout_container__2t4v2"><header class="layout_header__2rhWq"><a href="/blog-nextjs"><img src="images/sh.jpg" class="layout_headerImage__2h5On utils_borderCircle__13qdJ" alt="Pavel Slepenkov"/></a><h2 class="utils_headingLg__de7p0"><a class="utils_colorInherit__3Gudf" href="/blog-nextjs">Pavel Slepenkov</a></h2></header><main><article><h1 class="utils_headingXl__1XecN">Emulation of date and time on Force.com</h1><div class="utils_lightText__12Ckm"><time dateTime="2015-10-02T00:00:01+01:00">October 1, 2015</time></div><div><div>The one of the most significant things in testing is an ability to repeat your tests any number of times with the same state of environment. What is an environment state and how can we provide an ability to emulate the same state each time?
<div> Test environment includes the following components:</div>- Configuration (The state of the configuration and system parameters should be the same)
- Data level (it’s all data which needed for tests)
- Time (many operations depend on a time)
<div></div><div>Sure, it’s pretty simple if we’re talking about a data level as well as a configuration. In these areas we can reload a new data set each time if old data set will be broken. But what about a time? Here we have a strongly limitation but it might be avoided. So, we can implement the following solution on the top of system date/time. Such approach will be extremely useful for QA team. We’ll create a custom setting which will allow us to enable the time emulation, set a time shift and a fixed current time. So, let’s go ahead.</div><div></div><div>Go to **Setup –&gt; Develop –&gt; Custom Settings –&gt;** **Create** and create a new custom setting with hierarchy type. In my example I named it “Date Time Configuration” (DateTimeConfiguration__c) but you can name it as you want. But be aware that you need to change the code below for using your setting name.</div><div></div><div>Ok, let’s add a few fields. I created fields:</div><div>**Boolean isEmulationEnabled\_\_c,**</div><div> **DateTime emulatedDT\_\_c,**</div><div> **Integer dateShift\_\_c.**</div><div>It’s enough for our purposes.</div><div></div><div>So, we’ve finished with the creation of needed config and now we can implement a code.</div><div></div><div>**EDateTime.cls**</div><div>\[code language=”java”\]
public class EDateTime {
 private static DateTimeConfiguration\_\_c dtConfig;
 private static DateTime currentDateTime {
 get {
 currentDateTime = System.now();
 // on Production we always use real time
 if (!Utils.isProduction) {
 // Caching DateTime configuration
 if (dtConfig == null) {
 dtConfig = DateTimeConfiguration\_\_c.getInstance();
 }
 // if configuration exists and emulation is enabled we define new date and time
 if (dtConfig != null &amp;amp;amp;amp;&amp;amp;amp;amp; dtConfig.isEmulationEnabled\_\_c) {
 if (dtConfig.dateShift\_\_c != null ) {
 currentDateTime = System.now().addDays(dtConfig.dateShift\_\_c.intValue());
 } else {
 currentDateTime = dtConfig.emulatedDT\_\_c;
 }
 }
 }
 return currentDateTime;
 }
 }
<p>public static Date today() {
return currentDateTime.date();
}</p>
<p>public static DateTime now() {
return currentDateTime;
}</p>
<p>}</p>
<p>[/code]</p>
</div><div>**Utils.cls**</div><div></div><div>\[code language=”java”\]
public static Boolean isProduction {
 get {
 // The Prod Org Id is permanent and can be hardcoded
 return (UserInfo.getOrganizationId() == ’00DE0000000bplPMAX’ );
 }
 private set ;
}
\[/code\]
</div><div>Now you need to replace all invocation of System.now() in your code by a new one method EDateTime.now(), as well as System.today() by EDateTime.today().
Now you can reproduce your tests with the same date and time as many times as you want. It might be extremely useful if you’re testing a time-based solutions.</div><div></div><div>That’s it.</div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
</div></article></main><div class="layout_backToHome__1vZsp"><a href="/blog-nextjs">← Back to home</a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"p233","contentHtml":"\u003cdiv\u003eThe one of the most significant things in testing is an ability to repeat your tests any number of times with the same state of environment. What is an environment state and how can we provide an ability to emulate the same state each time?\n\u003cdiv\u003e Test environment includes the following components:\u003c/div\u003e- Configuration (The state of the configuration and system parameters should be the same)\n- Data level (it’s all data which needed for tests)\n- Time (many operations depend on a time)\n\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003eSure, it’s pretty simple if we’re talking about a data level as well as a configuration. In these areas we can reload a new data set each time if old data set will be broken. But what about a time? Here we have a strongly limitation but it might be avoided. So, we can implement the following solution on the top of system date/time. Such approach will be extremely useful for QA team. We’ll create a custom setting which will allow us to enable the time emulation, set a time shift and a fixed current time. So, let’s go ahead.\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003eGo to **Setup –\u0026gt; Develop –\u0026gt; Custom Settings –\u0026gt;** **Create** and create a new custom setting with hierarchy type. In my example I named it “Date Time Configuration” (DateTimeConfiguration__c) but you can name it as you want. But be aware that you need to change the code below for using your setting name.\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003eOk, let’s add a few fields. I created fields:\u003c/div\u003e\u003cdiv\u003e**Boolean isEmulationEnabled\\_\\_c,**\u003c/div\u003e\u003cdiv\u003e **DateTime emulatedDT\\_\\_c,**\u003c/div\u003e\u003cdiv\u003e **Integer dateShift\\_\\_c.**\u003c/div\u003e\u003cdiv\u003eIt’s enough for our purposes.\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003eSo, we’ve finished with the creation of needed config and now we can implement a code.\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e**EDateTime.cls**\u003c/div\u003e\u003cdiv\u003e\\[code language=”java”\\]\npublic class EDateTime {\n private static DateTimeConfiguration\\_\\_c dtConfig;\n private static DateTime currentDateTime {\n get {\n currentDateTime = System.now();\n // on Production we always use real time\n if (!Utils.isProduction) {\n // Caching DateTime configuration\n if (dtConfig == null) {\n dtConfig = DateTimeConfiguration\\_\\_c.getInstance();\n }\n // if configuration exists and emulation is enabled we define new date and time\n if (dtConfig != null \u0026amp;amp;amp;amp;\u0026amp;amp;amp;amp; dtConfig.isEmulationEnabled\\_\\_c) {\n if (dtConfig.dateShift\\_\\_c != null ) {\n currentDateTime = System.now().addDays(dtConfig.dateShift\\_\\_c.intValue());\n } else {\n currentDateTime = dtConfig.emulatedDT\\_\\_c;\n }\n }\n }\n return currentDateTime;\n }\n }\n\u003cp\u003epublic static Date today() {\nreturn currentDateTime.date();\n}\u003c/p\u003e\n\u003cp\u003epublic static DateTime now() {\nreturn currentDateTime;\n}\u003c/p\u003e\n\u003cp\u003e}\u003c/p\u003e\n\u003cp\u003e[/code]\u003c/p\u003e\n\u003c/div\u003e\u003cdiv\u003e**Utils.cls**\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\\[code language=”java”\\]\npublic static Boolean isProduction {\n get {\n // The Prod Org Id is permanent and can be hardcoded\n return (UserInfo.getOrganizationId() == ’00DE0000000bplPMAX’ );\n }\n private set ;\n}\n\\[/code\\]\n\u003c/div\u003e\u003cdiv\u003eNow you need to replace all invocation of System.now() in your code by a new one method EDateTime.now(), as well as System.today() by EDateTime.today().\nNow you can reproduce your tests with the same date and time as many times as you want. It might be extremely useful if you’re testing a time-based solutions.\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003eThat’s it.\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\n","title":"Emulation of date and time on Force.com","date":"2015-10-02T00:00:01+01:00","status":"publish","permalink":"/?p=233","author":"pavel","excerpt":"","type":"post","category":["apex","force.com"],"tag":["apex","date/time","date/time emulation","force.com"],"post_format":[],"fplayout":["default"],"original_post_id":["233"]}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"p233"},"buildId":"vyBdFlajjeQB2LRav_ReN","assetPrefix":"/blog-nextjs","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/blog-nextjs/_next/static/chunks/polyfills-11c8eba6a84e3fddec04.js"></script><script src="/blog-nextjs/_next/static/chunks/main-a7c970f167496c3f3d8f.js" async=""></script><script src="/blog-nextjs/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/blog-nextjs/_next/static/chunks/framework.2113c6061a2f456066a1.js" async=""></script><script src="/blog-nextjs/_next/static/chunks/commons.390514621f46153c0d8a.js" async=""></script><script src="/blog-nextjs/_next/static/chunks/pages/_app-63f54fbe8fbe4d14dff9.js" async=""></script><script src="/blog-nextjs/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.22009c787aae00c65fc7.js" async=""></script><script src="/blog-nextjs/_next/static/chunks/pages/posts/%5Bid%5D-4c37b983192d656c52ce.js" async=""></script><script src="/blog-nextjs/_next/static/vyBdFlajjeQB2LRav_ReN/_buildManifest.js" async=""></script><script src="/blog-nextjs/_next/static/vyBdFlajjeQB2LRav_ReN/_ssgManifest.js" async=""></script></body></html>