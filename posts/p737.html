<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><link href="https://unpkg.com/prismjs@1.23.0/themes/prism-okaidia.css" rel="stylesheet"/><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="description" content="Pavel Slepenkov&#x27;s personal blog: stories about BI, python, salesforce and data analysis"/><meta http-equiv="cache-control" content="Private"/><meta http-equiv="Expires" content="366000"/><meta property="og:locale" content="en_US"/><meta name="og:title" content="Pavel Slepenkov&#x27;s personal blog"/><meta property="og:description" content="stories about BI, python, salesforce and data analysis"/><meta property="og:type" content="article"/><meta property="og:site_name" content="pavelslepenkov.info"/><meta property="og:image" content="/og.png"/><meta name="twitter:title" content="Pavel Slepenkov&#x27;s personal blog"/><meta name="twitter:description" content="stories about BI, python, salesforce and data analysis"/><meta name="twitter:card" content="summary_large_image"/><meta property="twitter:image" content="/og.png"/><meta name="keywords" content="python, BI, sql, salesforce, data engineering, apex, soql, data analisys"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-63037633-1"></script><script>
                            window.dataLayer = window.dataLayer || [];
                            function gtag(){dataLayer.push(arguments);}
                            gtag('js', new Date());
                            gtag('config', 'UA-63037633-1');
                    </script><style>@import url(&#x27;https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300&amp;family=Spectral:wght@300;600&amp;display=swap&#x27;);</style><title>Cleaning salesforce profiles before deployment</title><meta name="next-head-count" content="23"/><link rel="preload" href="/_next/static/css/8ed85b7126e02c37.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8ed85b7126e02c37.css" data-n-g=""/><link rel="preload" href="/_next/static/css/992deef8d09b5c87.css" as="style"/><link rel="stylesheet" href="/_next/static/css/992deef8d09b5c87.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-ad45764ecfcae9e5.js" defer=""></script><script src="/_next/static/chunks/main-ee0cf4b7f81d7c24.js" defer=""></script><script src="/_next/static/chunks/pages/_app-2398585b21d2d8c8.js" defer=""></script><script src="/_next/static/chunks/105-51803cf0fd5a7825.js" defer=""></script><script src="/_next/static/chunks/358-14c60bb94e9d94b9.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-c9b3c3f336e43dc2.js" defer=""></script><script src="/_next/static/I51xPrn8yyP2LVyLK0Zvp/_buildManifest.js" defer=""></script><script src="/_next/static/I51xPrn8yyP2LVyLK0Zvp/_ssgManifest.js" defer=""></script></head><body class="centered"><script src="noflash.js"></script><script src="PathSolver.js"></script><div id="__next"><div class="layout_container__fbLkO"><div class="no-print"><header class="layout_header__kY0Lt"><div class="navbar-link centered"><a class="layout_devNull__CjwH1" href="/">Technical notes</a>‚Äî‚Äî‚Äî‚Äî‚Äî<a class="layout_devNull__CjwH1" href="/cv">CV</a>‚Äî‚Äî‚Äî‚Äî‚Äî<a class="layout_devNull__CjwH1" href="/books">Books &amp; Readings</a></div><div class="DarkModeToggle_darkModeToggle__m5z3H"><button type="button">üåû</button><button type="button">üåö</button></div></header></div><main><article><h1 class="utils_headingXl__u25Y2">Cleaning salesforce profiles before deployment</h1><div class="utils_lightText__eUzGY"><time dateTime="2016-12-29T14:01:17+00:00">December 29, 2016</time></div><div><p>That's quite common case when you face the following errors during deployment:</p>
<div class="remark-highlight"><pre class="language-java"><code class="language-java">profiles<span class="token operator">/</span><span class="token class-name">Admin</span><span class="token punctuation">.</span>profile ‚Äî <span class="token class-name">Error</span><span class="token operator">:</span> <span class="token class-name">Unknown</span> user permission<span class="token operator">:</span> <span class="token class-name">EditBillingInfo</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>span<span class="token operator">></span>
profiles<span class="token operator">/</span><span class="token class-name">Admin</span><span class="token punctuation">.</span>profile ‚Äî <span class="token class-name">Error</span><span class="token operator">:</span> <span class="token class-name">Unknown</span> user permission<span class="token operator">:</span> <span class="token class-name">ManageSandboxes</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>span<span class="token operator">></span>
profiles<span class="token operator">/</span><span class="token class-name">Admin</span><span class="token punctuation">.</span>profile ‚Äî <span class="token class-name">Error</span><span class="token operator">:</span> <span class="token class-name">Unknown</span> user permission<span class="token operator">:</span> <span class="token class-name">SocialInsightsLogoAdmin</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>span<span class="token operator">></span>
profiles<span class="token operator">/</span><span class="token class-name">Admin</span><span class="token punctuation">.</span>profile ‚Äî <span class="token class-name">Error</span><span class="token operator">:</span> <span class="token class-name">Unknown</span> user permission<span class="token operator">:</span> <span class="token class-name">EditPublicReports</span>
profiles<span class="token operator">/</span><span class="token class-name">Admin</span><span class="token punctuation">.</span>profile ‚Äî <span class="token class-name">Error</span><span class="token operator">:</span> <span class="token class-name">Unknown</span> user permission<span class="token operator">:</span> <span class="token class-name">DataExport</span>
</code></pre></div>
<p>Usually it means you trying to deploy the org which has no features which source org has. It might be a case when you deploy from Production to Sandbox or from some production org to developer edition. All what you can do with this error is to clean up profiles. Usually you do that by hand in any text editor. But I decided to build a small script in python which will do all the stuff automatically during deployment.</p>
<div class="remark-highlight"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">from</span> xml<span class="token punctuation">.</span>etree <span class="token keyword">import</span> cElementTree <span class="token keyword">as</span> et

<span class="token builtin">dir</span> <span class="token operator">=</span> <span class="token string">'../src/profiles/'</span>
nodes_to_remove <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'EditBillingInfo'</span><span class="token punctuation">,</span> <span class="token string">'ManageSandboxes'</span><span class="token punctuation">,</span> <span class="token string">'SocialInsightsLogoAdmin'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">clean_profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    et<span class="token punctuation">.</span>register_namespace<span class="token punctuation">(</span>‚Äù<span class="token punctuation">,</span> <span class="token string">"http://soap.sforce.com/2006/04/metadata"</span><span class="token punctuation">)</span>
    tr <span class="token operator">=</span> et<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>xml_file<span class="token punctuation">)</span>
    root <span class="token operator">=</span> tr<span class="token punctuation">.</span>getroot<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> child <span class="token keyword">in</span> root<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token string">'userPermissions'</span> <span class="token keyword">in</span> child<span class="token punctuation">.</span>tag<span class="token punctuation">:</span>
            <span class="token keyword">for</span> element <span class="token keyword">in</span> child<span class="token punctuation">:</span>
                <span class="token keyword">for</span> node <span class="token keyword">in</span> nodes_to_remove<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> <span class="token string">'name'</span> <span class="token keyword">in</span> element<span class="token punctuation">.</span>tag <span class="token keyword">and</span> node <span class="token keyword">in</span> element<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
                        root<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>child<span class="token punctuation">)</span>
                        <span class="token keyword">break</span>
    <span class="token keyword">return</span> root

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> filename <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">dir</span> <span class="token operator">+</span> filename<span class="token punctuation">,</span> <span class="token string">'r+b'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> xml_file<span class="token punctuation">:</span>
            result <span class="token operator">=</span> clean_profile<span class="token punctuation">(</span><span class="token punctuation">)</span>
            xml_str <span class="token operator">=</span> et<span class="token punctuation">.</span>tostring<span class="token punctuation">(</span>result<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8‚Ä≤, method='</span>xml'<span class="token punctuation">)</span>
            xml_file<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            xml_file<span class="token punctuation">.</span>truncate<span class="token punctuation">(</span><span class="token punctuation">)</span>
            xml_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b'&#x3C;?xml version="1.0" encoding="UTF-8"?>\n'</span> <span class="token operator">+</span> xml_str<span class="token punctuation">)</span>

</code></pre></div>
<p>as you can see you just need to add properties which you want to remove into <code>nodes_to_remove</code></p>
<p>Usually I put all scripts in <strong>scripts</strong> directory which is on the same level as <strong>src</strong> directory is, but if you want to locate the script in any other location you might need to fix dir variable for correct path to <strong>src/profiles</strong></p>
<p>and here's a <code>build.xml</code> part which consumes this script</p>
<div class="remark-highlight"><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>target</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>deploySandbox<span class="token punctuation">"</span></span> <span class="token attr-name">description</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Run cleaning scripts (for profiles) and upload source code to Sandbox<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>echo</span> <span class="token attr-name">message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢ SANDBOX DEPLOY ‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>echo</span> <span class="token attr-name">message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Step 1: PROFILES CLEANING:<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>exec</span> <span class="token attr-name">dir</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>scripts<span class="token punctuation">"</span></span> <span class="token attr-name">executable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>python3<span class="token punctuation">"</span></span> <span class="token attr-name">failonerror</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>arg</span> <span class="token attr-name">line</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>profile_cleaner.py results.log<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>exec</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>echo</span> <span class="token attr-name">message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>echo</span> <span class="token attr-name">message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Step 2:<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>echo</span> <span class="token attr-name">message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Deploy with User Name: ${sf.username} To ${sf.serverurl}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>!‚Äì</span> <span class="token attr-name">Upload</span> <span class="token attr-name">the</span> <span class="token attr-name">contents</span> <span class="token attr-name">of</span> <span class="token attr-name">the</span> <span class="token attr-name">"src"</span> <span class="token attr-name">directory</span> <span class="token attr-name">and</span> <span class="token attr-name">run</span> <span class="token attr-name">all</span> <span class="token attr-name">test</span> <span class="token attr-name">‚Äì</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token namespace">sf:</span>deploy</span> <span class="token attr-name">username</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${sf.username}<span class="token punctuation">"</span></span>
        <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${sf.password}<span class="token punctuation">"</span></span>
        <span class="token attr-name">serverurl</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${sf.serverurl}<span class="token punctuation">"</span></span>
        <span class="token attr-name">deployRoot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>src<span class="token punctuation">"</span></span>
        <span class="token attr-name">runAllTests</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
        <span class="token attr-name">maxPoll</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3000<span class="token punctuation">"</span></span>
        <span class="token attr-name">pollWaitMillis</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>150<span class="token punctuation">"</span></span>
        <span class="token attr-name">testLevel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>RunLocalTests<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span><span class="token namespace">sf:</span>deploy</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>target</span><span class="token punctuation">></span></span>
</code></pre></div>
</div></article><div><span class="utils_tag__r8GDN"><a href="/tag/ant">[<!-- -->ant<!-- -->]</a></span><span class="utils_tag__r8GDN"><a href="/tag/ant-migration-tool">[<!-- -->ant migration tool<!-- -->]</a></span><span class="utils_tag__r8GDN"><a href="/tag/automation">[<!-- -->automation<!-- -->]</a></span><span class="utils_tag__r8GDN"><a href="/tag/python">[<!-- -->python<!-- -->]</a></span><span class="utils_tag__r8GDN"><a href="/tag/script">[<!-- -->script<!-- -->]</a></span><span class="utils_tag__r8GDN"><a href="/tag/scripts">[<!-- -->scripts<!-- -->]</a></span></div></main><div class="layout_backToHome__9sjx_"><a href="/">‚áê back to home</a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"p737","contentHtml":"\u003cp\u003eThat's quite common case when you face the following errors during deployment:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-java\"\u003e\u003ccode class=\"language-java\"\u003eprofiles\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eAdmin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eprofile ‚Äî \u003cspan class=\"token class-name\"\u003eError\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eUnknown\u003c/span\u003e user permission\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eEditBillingInfo\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003espan\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\nprofiles\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eAdmin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eprofile ‚Äî \u003cspan class=\"token class-name\"\u003eError\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eUnknown\u003c/span\u003e user permission\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eManageSandboxes\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003espan\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\nprofiles\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eAdmin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eprofile ‚Äî \u003cspan class=\"token class-name\"\u003eError\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eUnknown\u003c/span\u003e user permission\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eSocialInsightsLogoAdmin\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003espan\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\nprofiles\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eAdmin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eprofile ‚Äî \u003cspan class=\"token class-name\"\u003eError\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eUnknown\u003c/span\u003e user permission\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eEditPublicReports\u003c/span\u003e\nprofiles\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eAdmin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eprofile ‚Äî \u003cspan class=\"token class-name\"\u003eError\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eUnknown\u003c/span\u003e user permission\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eDataExport\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eUsually it means you trying to deploy the org which has no features which source org has. It might be a case when you deploy from Production to Sandbox or from some production org to developer edition. All what you can do with this error is to clean up profiles. Usually you do that by hand in any text editor. But I decided to build a small script in python which will do all the stuff automatically during deployment.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e os\n\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e xml\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eetree \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e cElementTree \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e et\n\n\u003cspan class=\"token builtin\"\u003edir\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'../src/profiles/'\u003c/span\u003e\nnodes_to_remove \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'EditBillingInfo'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'ManageSandboxes'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'SocialInsightsLogoAdmin'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003eclean_profile\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    et\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eregister_namespace\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e‚Äù\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"http://soap.sforce.com/2006/04/metadata\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    tr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e et\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eparse\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003exml_file\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    root \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e tr\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003egetroot\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e child \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e root\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token string\"\u003e'userPermissions'\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e child\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etag\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e element \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e child\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e node \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e nodes_to_remove\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token string\"\u003e'name'\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e element\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etag \u003cspan class=\"token keyword\"\u003eand\u003c/span\u003e node \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e element\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etext\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n                        root\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eremove\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003echild\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                        \u003cspan class=\"token keyword\"\u003ebreak\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e root\n\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e __name__ \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token string\"\u003e'__main__'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e filename \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e os\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elistdir\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token builtin\"\u003edir\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eopen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token builtin\"\u003edir\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e filename\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'r+b'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e xml_file\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            result \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e clean_profile\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            xml_str \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e et\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etostring\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eresult\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e encoding\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'utf-8‚Ä≤, method='\u003c/span\u003exml'\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            xml_file\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eseek\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            xml_file\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etruncate\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            xml_file\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewrite\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003eb'\u0026#x3C;?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\\n'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e xml_str\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eas you can see you just need to add properties which you want to remove into \u003ccode\u003enodes_to_remove\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eUsually I put all scripts in \u003cstrong\u003escripts\u003c/strong\u003e directory which is on the same level as \u003cstrong\u003esrc\u003c/strong\u003e directory is, but if you want to locate the script in any other location you might need to fix dir variable for correct path to \u003cstrong\u003esrc/profiles\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eand here's a \u003ccode\u003ebuild.xml\u003c/code\u003e part which consumes this script\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-xml\"\u003e\u003ccode class=\"language-xml\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003etarget\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ename\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003edeploySandbox\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003edescription\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eRun cleaning scripts (for profiles) and upload source code to Sandbox\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eecho\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003emessage\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢ SANDBOX DEPLOY ‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eecho\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003emessage\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eStep 1: PROFILES CLEANING:\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eexec\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003edir\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003escripts\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eexecutable\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003epython3\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003efailonerror\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003etrue\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003earg\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eline\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eprofile_cleaner.py results.log\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eexec\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eecho\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003emessage\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eecho\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003emessage\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eStep 2:\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eecho\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003emessage\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eDeploy with User Name: ${sf.username} To ${sf.serverurl}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e!‚Äì\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eUpload\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ethe\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003econtents\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eof\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ethe\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003e\"src\"\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003edirectory\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eand\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003erun\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eall\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003etest\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003e‚Äì\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token namespace\"\u003esf:\u003c/span\u003edeploy\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eusername\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e${sf.username}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token attr-name\"\u003epassword\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e${sf.password}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token attr-name\"\u003eserverurl\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e${sf.serverurl}\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token attr-name\"\u003edeployRoot\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003esrc\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token attr-name\"\u003erunAllTests\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003etrue\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token attr-name\"\u003emaxPoll\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e3000\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token attr-name\"\u003epollWaitMillis\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e150\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token attr-name\"\u003etestLevel\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eRunLocalTests\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003e\u003cspan class=\"token namespace\"\u003esf:\u003c/span\u003edeploy\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003etarget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n","title":"Cleaning salesforce profiles before deployment","date":"2016-12-29T14:01:17+00:00","status":"publish","permalink":"/?p=737","author":"pavel","excerpt":"","type":"post","category":["force.com","migration tool","scripts","Uncategorized"],"tag":["ant","ant migration tool","automation","python","script","scripts"],"post_format":[],"dsq_thread_id":["5591329147"]}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"p737"},"buildId":"I51xPrn8yyP2LVyLK0Zvp","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>