<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><link rel="preload" href="https://unpkg.com/prismjs@0.0.1/themes/prism-tomorrow.css" as="script"/><link rel="preload" href="https://unpkg.com/prismjs@0.0.1/themes/prism-coy.css" as="script"/><link rel="preload" href="https://unpkg.com/prismjs@0.0.1/themes/prism-okaidia.css" as="script"/><link rel="preload" href="https://unpkg.com/prismjs@0.0.1/themes/prism-funky.css" as="script"/><link href="https://unpkg.com/prismjs@0.0.1/themes/prism-okaidia.css" rel="stylesheet"/><meta name="description" content="Pavel Slepenkov - developer"/><meta property="og:image" content="https://og-image.now.sh/Pavel%20Slepenkov%20personal%20blog.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fhyper-color-logo.svg&amp;widths=auto"/><meta name="og:title" content="Pavel Slepenkov personal blog"/><meta name="twitter:card" content="summary_large_image"/><title>Cleaning profiles before deployment</title><meta name="next-head-count" content="13"/><link rel="preload" href="/blog-nextjs/_next/static/css/d9f62f5770aa60bc54db.css" as="style"/><link rel="stylesheet" href="/blog-nextjs/_next/static/css/d9f62f5770aa60bc54db.css" data-n-g=""/><link rel="preload" href="/blog-nextjs/_next/static/css/7b989d401051c7c1fc1a.css" as="style"/><link rel="stylesheet" href="/blog-nextjs/_next/static/css/7b989d401051c7c1fc1a.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/blog-nextjs/_next/static/chunks/main-a7c970f167496c3f3d8f.js" as="script"/><link rel="preload" href="/blog-nextjs/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/blog-nextjs/_next/static/chunks/framework.2113c6061a2f456066a1.js" as="script"/><link rel="preload" href="/blog-nextjs/_next/static/chunks/commons.390514621f46153c0d8a.js" as="script"/><link rel="preload" href="/blog-nextjs/_next/static/chunks/pages/_app-63f54fbe8fbe4d14dff9.js" as="script"/><link rel="preload" href="/blog-nextjs/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.c6af214380aa78d8cb3e.js" as="script"/><link rel="preload" href="/blog-nextjs/_next/static/chunks/pages/posts/%5Bid%5D-4c37b983192d656c52ce.js" as="script"/></head><body><div id="__next"><div class="layout_container__2t4v2"><header class="layout_header__2rhWq"><a href="/blog-nextjs"><img src="/images/sh.jpg" class="layout_headerImage__2h5On utils_borderCircle__13qdJ" alt="Pavel Slepenkov"/></a><h2 class="utils_headingLg__de7p0"><a class="utils_colorInherit__3Gudf" href="/blog-nextjs">Pavel Slepenkov</a></h2></header><main><article><h1 class="utils_headingXl__1XecN">Cleaning profiles before deployment</h1><div class="utils_lightText__12Ckm"><time dateTime="2016-12-29T14:01:17+00:00">December 29, 2016</time></div><div><p>It’s very common case that you can face the following errors during deployment:</p>
<blockquote>
<p><span class="s1">profiles/Admin.profile — Error: Unknown user permission: EditBillingInfo</span></p>
<p><span class="s1">profiles/Admin.profile — Error: Unknown user permission: ManageSandboxes</span></p>
<p><span class="s1">profiles/Admin.profile — Error: Unknown user permission: SocialInsightsLogoAdmin</span></p>
<p>profiles/Admin.profile — Error: Unknown user permission: EditPublicReports</p>
<p>profiles/Admin.profile — Error: Unknown user permission: DataExport</p>
</blockquote>
<p>Usually it means that you trying to deploy the org which has no features which source org had. It might be a case when you deploy from Production to Sandbox or from some production org to developer edition. All what you can do with this error is to clean up profiles. Usually you can do that by hand in any text editor. But I decided to build a small script in python which will do all the stuff automatically during deployment.</p>
<p>[python]
import os
from xml.etree import cElementTree as et</p>
<p>dir = ‘../src/profiles/’
nodes_to_remove = (‘EditBillingInfo’, ‘ManageSandboxes’, ‘SocialInsightsLogoAdmin’)</p>
<p>def clean_profile():
et.register_namespace(”, "http://soap.sforce.com/2006/04/metadata")
tr = et.parse(xml_file)
root = tr.getroot()
for child in root:
if ‘userPermissions’ in child.tag:
for element in child:
for node in nodes_to_remove:
if ‘name’ in element.tag and node in element.text:
root.remove(child)
break
return root</p>
<p>if __name__ == ‘__main__’:
for filename in os.listdir(dir):
with open(dir + filename, ‘r+b’) as xml_file:
result = clean_profile()
xml_str = et.tostring(result, encoding=’utf-8′, method=’xml’)
xml_file.seek(0)
xml_file.truncate()
xml_file.write(b’&#x26;lt;?xml version="1.0" encoding="UTF-8"?&#x26;gt;\n’ + xml_str)</p>
<p>[/python]</p>
<p>as you can see you just need to add properties which you want to remove into <code>nodes_to_remove</code></p>
<p>Usually I put all scripts in <strong>scripts</strong> directory which is on the same level as <strong>src</strong> directory is, but if you want to locate the script in any other location you might need to fix dir variable for correct path to <strong>src/profiles</strong></p>
<p>and here’s a build.xml part which consumes this script</p>
<p>[xml]
&#x3C;target name="deploySandbox" description="Run cleaning scripts (for profiles) and upload source code to Sandbox" >
&#x3C;echo message="••••••••••••••••••••••• SANDBOX DEPLOY •••••••••••••••••••••••" />
&#x3C;echo message="Step 1: PROFILES CLEANING:" />
&#x3C;exec dir="scripts" executable="python3" failonerror="true">
&#x3C;arg line="profile_cleaner.py results.log" />
&#x3C;/exec></p>
<p>&#x3C;echo message="———————————————————————————————" />
&#x3C;echo message="Step 2:" />
&#x3C;echo message="Deploy with User Name: ${sf.username} To ${sf.serverurl}" />
&#x3C;!– Upload the contents of the "src" directory and run all test –>
&#x3C;sf:deploy username="${sf.username}"
password="${sf.password}"
serverurl="${sf.serverurl}"
deployRoot="src"
runAllTests="true"
maxPoll="3000"
pollWaitMillis="150"
testLevel="RunLocalTests">
&#x3C;/sf:deploy>
&#x3C;/target>
[/xml]</p>
</div></article></main><div class="layout_backToHome__1vZsp"><a href="/blog-nextjs">← Back to home</a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"p737","contentHtml":"\u003cp\u003eIt’s very common case that you can face the following errors during deployment:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cspan class=\"s1\"\u003eprofiles/Admin.profile — Error: Unknown user permission: EditBillingInfo\u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e\u003cspan class=\"s1\"\u003eprofiles/Admin.profile — Error: Unknown user permission: ManageSandboxes\u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e\u003cspan class=\"s1\"\u003eprofiles/Admin.profile — Error: Unknown user permission: SocialInsightsLogoAdmin\u003c/span\u003e\u003c/p\u003e\n\u003cp\u003eprofiles/Admin.profile — Error: Unknown user permission: EditPublicReports\u003c/p\u003e\n\u003cp\u003eprofiles/Admin.profile — Error: Unknown user permission: DataExport\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eUsually it means that you trying to deploy the org which has no features which source org had. It might be a case when you deploy from Production to Sandbox or from some production org to developer edition. All what you can do with this error is to clean up profiles. Usually you can do that by hand in any text editor. But I decided to build a small script in python which will do all the stuff automatically during deployment.\u003c/p\u003e\n\u003cp\u003e[python]\nimport os\nfrom xml.etree import cElementTree as et\u003c/p\u003e\n\u003cp\u003edir = ‘../src/profiles/’\nnodes_to_remove = (‘EditBillingInfo’, ‘ManageSandboxes’, ‘SocialInsightsLogoAdmin’)\u003c/p\u003e\n\u003cp\u003edef clean_profile():\net.register_namespace(”, \"http://soap.sforce.com/2006/04/metadata\")\ntr = et.parse(xml_file)\nroot = tr.getroot()\nfor child in root:\nif ‘userPermissions’ in child.tag:\nfor element in child:\nfor node in nodes_to_remove:\nif ‘name’ in element.tag and node in element.text:\nroot.remove(child)\nbreak\nreturn root\u003c/p\u003e\n\u003cp\u003eif __name__ == ‘__main__’:\nfor filename in os.listdir(dir):\nwith open(dir + filename, ‘r+b’) as xml_file:\nresult = clean_profile()\nxml_str = et.tostring(result, encoding=’utf-8′, method=’xml’)\nxml_file.seek(0)\nxml_file.truncate()\nxml_file.write(b’\u0026#x26;lt;?xml version=\"1.0\" encoding=\"UTF-8\"?\u0026#x26;gt;\\n’ + xml_str)\u003c/p\u003e\n\u003cp\u003e[/python]\u003c/p\u003e\n\u003cp\u003eas you can see you just need to add properties which you want to remove into \u003ccode\u003enodes_to_remove\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eUsually I put all scripts in \u003cstrong\u003escripts\u003c/strong\u003e directory which is on the same level as \u003cstrong\u003esrc\u003c/strong\u003e directory is, but if you want to locate the script in any other location you might need to fix dir variable for correct path to \u003cstrong\u003esrc/profiles\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eand here’s a build.xml part which consumes this script\u003c/p\u003e\n\u003cp\u003e[xml]\n\u0026#x3C;target name=\"deploySandbox\" description=\"Run cleaning scripts (for profiles) and upload source code to Sandbox\" \u003e\n\u0026#x3C;echo message=\"••••••••••••••••••••••• SANDBOX DEPLOY •••••••••••••••••••••••\" /\u003e\n\u0026#x3C;echo message=\"Step 1: PROFILES CLEANING:\" /\u003e\n\u0026#x3C;exec dir=\"scripts\" executable=\"python3\" failonerror=\"true\"\u003e\n\u0026#x3C;arg line=\"profile_cleaner.py results.log\" /\u003e\n\u0026#x3C;/exec\u003e\u003c/p\u003e\n\u003cp\u003e\u0026#x3C;echo message=\"———————————————————————————————\" /\u003e\n\u0026#x3C;echo message=\"Step 2:\" /\u003e\n\u0026#x3C;echo message=\"Deploy with User Name: ${sf.username} To ${sf.serverurl}\" /\u003e\n\u0026#x3C;!– Upload the contents of the \"src\" directory and run all test –\u003e\n\u0026#x3C;sf:deploy username=\"${sf.username}\"\npassword=\"${sf.password}\"\nserverurl=\"${sf.serverurl}\"\ndeployRoot=\"src\"\nrunAllTests=\"true\"\nmaxPoll=\"3000\"\npollWaitMillis=\"150\"\ntestLevel=\"RunLocalTests\"\u003e\n\u0026#x3C;/sf:deploy\u003e\n\u0026#x3C;/target\u003e\n[/xml]\u003c/p\u003e\n","title":"Cleaning profiles before deployment","date":"2016-12-29T14:01:17+00:00","status":"publish","permalink":"/?p=737","author":"pavel","excerpt":"","type":"post","category":["force.com","migration tool","scripts","Uncategorized"],"tag":["ant","ant migration tool","automation","python","script","scripts"],"post_format":[],"dsq_thread_id":["5591329147"]}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"p737"},"buildId":"QJoidi8DS-xszWa-bGUPq","assetPrefix":"/blog-nextjs","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/blog-nextjs/_next/static/chunks/polyfills-11c8eba6a84e3fddec04.js"></script><script src="/blog-nextjs/_next/static/chunks/main-a7c970f167496c3f3d8f.js" async=""></script><script src="/blog-nextjs/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/blog-nextjs/_next/static/chunks/framework.2113c6061a2f456066a1.js" async=""></script><script src="/blog-nextjs/_next/static/chunks/commons.390514621f46153c0d8a.js" async=""></script><script src="/blog-nextjs/_next/static/chunks/pages/_app-63f54fbe8fbe4d14dff9.js" async=""></script><script src="/blog-nextjs/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.c6af214380aa78d8cb3e.js" async=""></script><script src="/blog-nextjs/_next/static/chunks/pages/posts/%5Bid%5D-4c37b983192d656c52ce.js" async=""></script><script src="/blog-nextjs/_next/static/QJoidi8DS-xszWa-bGUPq/_buildManifest.js" async=""></script><script src="/blog-nextjs/_next/static/QJoidi8DS-xszWa-bGUPq/_ssgManifest.js" async=""></script></body></html>