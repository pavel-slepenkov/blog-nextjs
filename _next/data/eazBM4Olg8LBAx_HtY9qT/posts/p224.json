{"pageProps":{"postData":{"id":"p224","contentHtml":"<p>It's the often case when we need to get a profile id for specified profiles and reuse it from different context. And usually it looks like this</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Profile</span> profileId <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>SELECT <span class=\"token class-name\">Id</span> FROM <span class=\"token class-name\">Profile</span> WHERE <span class=\"token class-name\">Name</span> <span class=\"token operator\">=</span> <span class=\"token string\">'System Administrator'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>And you can find such code in a few different places of your codebase, it will be compounded if your team has more than 1 developer. Therefore such code should be moved to utility classes.\nBelow you can find solution for getting a profile id by the name.</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Id</span><span class=\"token punctuation\">></span></span> profileIdByName <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Id</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Id</span> <span class=\"token function\">getProfileIdByName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> profileName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">isBlank</span><span class=\"token punctuation\">(</span>profileName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CommonException</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Label</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">MethodHasGotIncorrectArgument</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>profileIdByName<span class=\"token punctuation\">.</span><span class=\"token function\">containsKey</span><span class=\"token punctuation\">(</span>profileName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> profileIdByName<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>profileName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">Id</span> profileId <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>SELECT <span class=\"token class-name\">Id</span> FROM <span class=\"token class-name\">Profile</span> <span class=\"token class-name\">WHERE</span> name <span class=\"token operator\">=</span><span class=\"token operator\">:</span> profileName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Id</span><span class=\"token punctuation\">;</span>\n            profileIdByName<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>profileName<span class=\"token punctuation\">,</span> profileId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> profileId<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">QueryException</span> qEx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ERROR:'</span> <span class=\"token operator\">+</span> qEx<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">', in line'</span> <span class=\"token operator\">+</span> qEx<span class=\"token punctuation\">.</span><span class=\"token function\">getLineNumber</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CommonException</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Label</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">ProfileNotFound</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// never fire</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Unit tests:</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@isTest</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">getProfileIdByNameWhenArgumentIsEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Utils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getProfileIdByName</span><span class=\"token punctuation\">(</span>‚Äù<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CommonException</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertEquals</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Label</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">MethodHasGotIncorrectArgument</span><span class=\"token punctuation\">,</span> ex<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@isTest</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">getProfileIdByNameWhenProfileDoesNotExist</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Utils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getProfileIdByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'123321123'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CommonException</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertEquals</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Label</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">ProfileNotFound</span><span class=\"token punctuation\">,</span> ex<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@isTest</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">getProfileIdByNameWhenQueredExistingKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Id</span> profileId <span class=\"token operator\">=</span> <span class=\"token class-name\">Utils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getProfileIdByName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">GlobalConstants</span><span class=\"token punctuation\">.</span>PROFILE_SYSTEM_ADMINISTRATOR<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertEquals</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Limits</span><span class=\"token punctuation\">.</span><span class=\"token function\">getQueries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertEquals</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>SELECT <span class=\"token class-name\">Id</span> FROM <span class=\"token class-name\">Profile</span> WHERE <span class=\"token class-name\">Name</span> <span class=\"token operator\">=</span><span class=\"token operator\">:</span><span class=\"token class-name\">GlobalConstants</span><span class=\"token punctuation\">.</span>PROFILE_SYSTEM_ADMINISTRATOR<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Id</span><span class=\"token punctuation\">,</span> profileId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Utils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getProfileIdByName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">GlobalConstants</span><span class=\"token punctuation\">.</span>PROFILE_SYSTEM_ADMINISTRATOR<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Utils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getProfileIdByName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">GlobalConstants</span><span class=\"token punctuation\">.</span>PROFILE_SYSTEM_ADMINISTRATOR<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertEquals</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Limits</span><span class=\"token punctuation\">.</span><span class=\"token function\">getQueries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@isTest</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">getProfileIdByNameWhenQueredForFewKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Id</span> profileId <span class=\"token operator\">=</span> <span class=\"token class-name\">Utils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getProfileIdByName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">GlobalConstants</span><span class=\"token punctuation\">.</span>PROFILE_SYSTEM_ADMINISTRATOR<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertEquals</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Limits</span><span class=\"token punctuation\">.</span><span class=\"token function\">getQueries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertEquals</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>SELECT <span class=\"token class-name\">Id</span> FROM <span class=\"token class-name\">Profile</span> WHERE <span class=\"token class-name\">Name</span> <span class=\"token operator\">=</span><span class=\"token operator\">:</span><span class=\"token class-name\">GlobalConstants</span><span class=\"token punctuation\">.</span>PROFILE_SYSTEM_ADMINISTRATOR<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Id</span><span class=\"token punctuation\">,</span> profileId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertEquals</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Limits</span><span class=\"token punctuation\">.</span><span class=\"token function\">getQueries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    profileId <span class=\"token operator\">=</span> <span class=\"token class-name\">Utils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getProfileIdByName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">GlobalConstants</span><span class=\"token punctuation\">.</span>PROFILE_BRANCH_STANDARD_PLATFORM_USER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertEquals</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Limits</span><span class=\"token punctuation\">.</span><span class=\"token function\">getQueries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertEquals</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>SELECT <span class=\"token class-name\">Id</span> FROM <span class=\"token class-name\">Profile</span> WHERE <span class=\"token class-name\">Name</span> <span class=\"token operator\">=</span><span class=\"token operator\">:</span><span class=\"token class-name\">GlobalConstants</span><span class=\"token punctuation\">.</span>PROFILE_BRANCH_STANDARD_PLATFORM_USER<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Id</span><span class=\"token punctuation\">,</span> profileId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertEquals</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Limits</span><span class=\"token punctuation\">.</span><span class=\"token function\">getQueries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Utils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getProfileIdByName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">GlobalConstants</span><span class=\"token punctuation\">.</span>PROFILE_BRANCH_STANDARD_PLATFORM_USER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Utils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getProfileIdByName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">GlobalConstants</span><span class=\"token punctuation\">.</span>PROFILE_SYSTEM_ADMINISTRATOR<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertEquals</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Limits</span><span class=\"token punctuation\">.</span><span class=\"token function\">getQueries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n","title":"Salesforce: getting a profile id by the name","date":"2013-08-29T13:22:12+01:00","status":"publish","permalink":"/?p=224","author":"pavel","excerpt":"","type":"post","category":["force.com"],"tag":["apex","force.com"],"post_format":[],"fplayout":["fullwidth"],"original_post_id":["224"],"dsq_thread_id":["5588897425"]}},"__N_SSG":true}