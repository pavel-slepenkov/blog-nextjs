{"pageProps":{"postData":{"id":"p1059","contentHtml":"<p>I screw up DatedConversionRate data loading with ~2800 records created with incorrect StartDate. As I can retrieve it via SOQL I quickly created some apex script. Something like that</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\">delete <span class=\"token punctuation\">[</span>\n    <span class=\"token constant\">SELECT</span> <span class=\"token class-name\">Id</span>\n    <span class=\"token constant\">FROM</span> <span class=\"token class-name\">DatedConversionRate</span>\n    <span class=\"token constant\">WHERE</span> <span class=\"token class-name\">CreatedDate</span> <span class=\"token operator\">=</span> <span class=\"token constant\">TODAY</span>\n    <span class=\"token constant\">AND</span> <span class=\"token class-name\">StartDate</span> <span class=\"token operator\">&#x3C;</span> <span class=\"token number\">2018</span><span class=\"token operator\">-</span><span class=\"token number\">01</span><span class=\"token operator\">-</span><span class=\"token number\">01</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>and got this</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token constant\">DML</span> operation <span class=\"token class-name\">Delete</span> not allowed on <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">DatedConversionRate</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>Not cool at all. Also I could not update StartDate with error</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token constant\">DML</span> operation <span class=\"token class-name\">Update</span> not allowed on <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">DatedConversionRate</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>Okay. Quick googling give me the <a href=\"https://salesforce.stackexchange.com/questions/13282/updating-multi-currency-rates-from-apex\">solution</a>. Hereâ€™s solution for create/update and delete DatedConversionRate via SOAP API. So, basically you can do it from Apex</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">HttpRequest</span> req <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nreq<span class=\"token punctuation\">.</span><span class=\"token function\">setEndpoint</span><span class=\"token punctuation\">(</span><span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSalesforceBaseUrl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toExternalForm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> '<span class=\"token operator\">/</span>services<span class=\"token operator\">/</span>data<span class=\"token operator\">/</span>v45<span class=\"token punctuation\">.</span><span class=\"token number\">0</span><span class=\"token operator\">/</span>sobjects<span class=\"token operator\">/</span><span class=\"token class-name\">DatedConversionRate</span><span class=\"token operator\">/</span><span class=\"token number\">04</span>w0e0000000Po1AAE<span class=\"token operator\">?</span>_HttpMethod<span class=\"token operator\">=</span><span class=\"token constant\">DELETE</span>'<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nreq<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span>'<span class=\"token class-name\">Authorization</span><span class=\"token char\">', '</span><span class=\"token class-name\">OAuth</span> ' <span class=\"token operator\">+</span> <span class=\"token class-name\">UserInfo</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSessionId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nreq<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span>'<span class=\"token class-name\">Content</span><span class=\"token operator\">-</span><span class=\"token class-name\">Type</span><span class=\"token char\">', '</span>application<span class=\"token operator\">/</span>json'<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nreq<span class=\"token punctuation\">.</span><span class=\"token function\">setMethod</span><span class=\"token punctuation\">(</span><span class=\"token char\">'POST'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">HttpResponse</span> res <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Http</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>But because I had ~2800 records to remove I decided to go with python</p>\n<div class=\"remark-highlight\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> request\n\nrecord_ids_to_delete <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'04w0e0000000Po1AAE'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'04w0e0000000Po0AAE'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'04w0e0000000PnzAAE'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token number\">.2800</span> ids<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">]</span>\nheaders <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"Authorization\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Bearer AQMAQPJ.ZAiHxG.LUaDqgUabvVdCao77Lq2R2kzcOP0fwMk7lbHA4G7va4U1jRfL_W0hFRBswLYTox2q1yLAsfL93MismKCC\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"Content-Type\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"application/json\"</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">for</span> record_id <span class=\"token keyword\">in</span> record_ids_to_delete<span class=\"token punctuation\">:</span>\n    url <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f'https://my-org-name.my.salesforce.com/services/data/v45.0/sobjects/DatedConversionRate/</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>record_id<span class=\"token punctuation\">}</span></span><span class=\"token string\">?_HttpMethod=DELETE'</span></span>\n    requests<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> headers<span class=\"token operator\">=</span>headers<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>this script might be much more improved for sure. You can add session id generation and use SOQL for retrieving record ids. But I guess this script is just one time thing and copying/pasting session id from browser/any other source as well as quick generation of monstrous array in sublime text are not so big deal when you have to fix it asap.</p>\n","title":"BULK remove of DatedConversionRate","date":"2019-06-07T15:45:22+01:00","status":"publish","permalink":"/?p=1059","author":"pavel","excerpt":"","type":"post","category":["scripts"],"tag":["python","salesforce","script","soap api"],"post_format":[]}},"__N_SSG":true}