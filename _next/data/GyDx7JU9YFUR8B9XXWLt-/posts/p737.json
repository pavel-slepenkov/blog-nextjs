{"pageProps":{"postData":{"id":"p737","contentHtml":"<p>It’s very common case that you can face the following errors during deployment:</p>\n<blockquote>\n<p><span class=\"s1\">profiles/Admin.profile — Error: Unknown user permission: EditBillingInfo</span></p>\n<p><span class=\"s1\">profiles/Admin.profile — Error: Unknown user permission: ManageSandboxes</span></p>\n<p><span class=\"s1\">profiles/Admin.profile — Error: Unknown user permission: SocialInsightsLogoAdmin</span></p>\n<p>profiles/Admin.profile — Error: Unknown user permission: EditPublicReports</p>\n<p>profiles/Admin.profile — Error: Unknown user permission: DataExport</p>\n</blockquote>\n<p>Usually it means that you trying to deploy the org which has no features which source org had. It might be a case when you deploy from Production to Sandbox or from some production org to developer edition. All what you can do with this error is to clean up profiles. Usually you can do that by hand in any text editor. But I decided to build a small script in python which will do all the stuff automatically during deployment.</p>\n<p>[python]\nimport os\nfrom xml.etree import cElementTree as et</p>\n<p>dir = ‘../src/profiles/’\nnodes_to_remove = (‘EditBillingInfo’, ‘ManageSandboxes’, ‘SocialInsightsLogoAdmin’)</p>\n<p>def clean_profile():\net.register_namespace(”, \"http://soap.sforce.com/2006/04/metadata\")\ntr = et.parse(xml_file)\nroot = tr.getroot()\nfor child in root:\nif ‘userPermissions’ in child.tag:\nfor element in child:\nfor node in nodes_to_remove:\nif ‘name’ in element.tag and node in element.text:\nroot.remove(child)\nbreak\nreturn root</p>\n<p>if __name__ == ‘__main__’:\nfor filename in os.listdir(dir):\nwith open(dir + filename, ‘r+b’) as xml_file:\nresult = clean_profile()\nxml_str = et.tostring(result, encoding=’utf-8′, method=’xml’)\nxml_file.seek(0)\nxml_file.truncate()\nxml_file.write(b’&#x26;lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&#x26;gt;\\n’ + xml_str)</p>\n<p>[/python]</p>\n<p>as you can see you just need to add properties which you want to remove into <code>nodes_to_remove</code></p>\n<p>Usually I put all scripts in <strong>scripts</strong> directory which is on the same level as <strong>src</strong> directory is, but if you want to locate the script in any other location you might need to fix dir variable for correct path to <strong>src/profiles</strong></p>\n<p>and here’s a build.xml part which consumes this script</p>\n<p>[xml]\n&#x3C;target name=\"deploySandbox\" description=\"Run cleaning scripts (for profiles) and upload source code to Sandbox\" >\n&#x3C;echo message=\"••••••••••••••••••••••• SANDBOX DEPLOY •••••••••••••••••••••••\" />\n&#x3C;echo message=\"Step 1: PROFILES CLEANING:\" />\n&#x3C;exec dir=\"scripts\" executable=\"python3\" failonerror=\"true\">\n&#x3C;arg line=\"profile_cleaner.py results.log\" />\n&#x3C;/exec></p>\n<p>&#x3C;echo message=\"———————————————————————————————\" />\n&#x3C;echo message=\"Step 2:\" />\n&#x3C;echo message=\"Deploy with User Name: ${sf.username} To ${sf.serverurl}\" />\n&#x3C;!– Upload the contents of the \"src\" directory and run all test –>\n&#x3C;sf:deploy username=\"${sf.username}\"\npassword=\"${sf.password}\"\nserverurl=\"${sf.serverurl}\"\ndeployRoot=\"src\"\nrunAllTests=\"true\"\nmaxPoll=\"3000\"\npollWaitMillis=\"150\"\ntestLevel=\"RunLocalTests\">\n&#x3C;/sf:deploy>\n&#x3C;/target>\n[/xml]</p>\n","title":"Cleaning profiles before deployment","date":"2016-12-29T14:01:17+00:00","status":"publish","permalink":"/?p=737","author":"pavel","excerpt":"","type":"post","category":["force.com","migration tool","scripts","Uncategorized"],"tag":["ant","ant migration tool","automation","python","script","scripts"],"post_format":[],"dsq_thread_id":["5591329147"]}},"__N_SSG":true}