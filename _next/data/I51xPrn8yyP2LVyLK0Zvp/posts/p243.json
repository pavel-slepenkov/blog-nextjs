{"pageProps":{"postData":{"id":"p243","contentHtml":"<p>You can hit by this error, if you are a rookie in scheduled apex and trying to call external service.</p>\n<p>Imagine, that we need to ping this blog from time to time, for an instance once per hour.So you will write something like that</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\">global <span class=\"token keyword\">class</span> <span class=\"token class-name\">PingBlog</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Schedulable</span><span class=\"token punctuation\">{</span>\n    global <span class=\"token keyword\">void</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SchedulableContext</span> <span class=\"token constant\">SC</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">HttpRequest</span> req <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    req<span class=\"token punctuation\">.</span><span class=\"token function\">setEndpoint</span><span class=\"token punctuation\">(</span>‘http<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>blog<span class=\"token punctuation\">.</span>pavelslepenkov<span class=\"token punctuation\">.</span>info’<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    req<span class=\"token punctuation\">.</span><span class=\"token function\">setMethod</span><span class=\"token punctuation\">(</span>‘<span class=\"token constant\">GET</span>’<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Http</span> http <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Http</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">HTTPResponse</span> res <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">LoggingLevel</span><span class=\"token punctuation\">.</span><span class=\"token constant\">INFO</span><span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>It’s simple. After that you will schedule this class</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">PingBlog</span> pingBlog <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PingBlog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">String</span> sch <span class=\"token operator\">=</span> ‘<span class=\"token number\">0</span> <span class=\"token number\">00</span> <span class=\"token operator\">*</span> <span class=\"token operator\">*</span> <span class=\"token operator\">*</span> <span class=\"token operator\">?</span>’<span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">schedule</span><span class=\"token punctuation\">(</span>‘ping blog’<span class=\"token punctuation\">,</span> sch<span class=\"token punctuation\">,</span> pingBlog<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>And as a result you will get the following error when your class run:</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">    Apex script unhandled exception by user/organization: 005E0000001xBrt/00DE0000000xRRo\n    Scheduled job ‘ping blog’ threw unhandled exception.\n    caused by: **System.CalloutException: Callout from scheduled Apex not supported**.\n    Class.PingBlog.execute: line 7, column 1</code></pre></div>\n<p>The solution is pretty simple, just move a callout into method with <code>@future</code> annotation.</p>\n<div class=\"remark-highlight\"><pre class=\"language-java\"><code class=\"language-java\">global <span class=\"token keyword\">class</span> <span class=\"token class-name\">PingBlog</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Schedulable</span><span class=\"token punctuation\">{</span>\n        global <span class=\"token keyword\">void</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SchedulableContext</span> <span class=\"token constant\">SC</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">Ping</span><span class=\"token punctuation\">.</span><span class=\"token function\">pingBlog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n     <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Ping</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token annotation punctuation\">@future</span><span class=\"token punctuation\">(</span>callout<span class=\"token operator\">=</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">pingBlog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">HttpRequest</span> req <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            req<span class=\"token punctuation\">.</span><span class=\"token function\">setEndpoint</span><span class=\"token punctuation\">(</span>‘http<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>blog<span class=\"token punctuation\">.</span>pavelslepenkov<span class=\"token punctuation\">.</span>info’<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            req<span class=\"token punctuation\">.</span><span class=\"token function\">setMethod</span><span class=\"token punctuation\">(</span>‘<span class=\"token constant\">GET</span>’<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">Http</span> http <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Http</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">HTTPResponse</span> res <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n</code></pre></div>\n","title":"Apex Exception: Callout from scheduled Apex not supported","date":"2013-10-20T10:01:59+01:00","status":"publish","permalink":"/?p=243","author":"pavel","excerpt":"","type":"post","category":["apex","force.com"],"tag":["apex","exceptions","force.com"],"post_format":[],"fplayout":["default"],"original_post_id":["243"],"dsq_thread_id":["5587874939"]}},"__N_SSG":true}